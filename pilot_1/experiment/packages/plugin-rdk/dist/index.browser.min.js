var jsPsychRdk=function(e){"use strict";function t(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function r(e,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,t(a.key),a)}}var o={name:"rdk",parameters:{choices:{type:e.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},correct_choice:{type:e.ParameterType.KEYS,pretty_name:"Correct choice",default:void 0},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:500},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},number_of_apertures:{type:e.ParameterType.INT,pretty_name:"Number of apertures",default:1},number_of_dots:{type:e.ParameterType.INT,pretty_name:"Number of dots",default:300},number_of_sets:{type:e.ParameterType.INT,pretty_name:"Number of sets",default:1},coherent_direction:{type:e.ParameterType.INT,pretty_name:"Coherent direction",default:0},coherence:{type:e.ParameterType.FLOAT,pretty_name:"Coherence",default:.5},opposite_coherence:{type:e.ParameterType.FLOAT,pretty_name:"Opposite coherence",default:0},dot_radius:{type:e.ParameterType.INT,pretty_name:"Dot radius",default:2},dot_side_length:{type:e.ParameterType.INT,pretty_name:"Dot side length",default:1},dot_life:{type:e.ParameterType.INT,pretty_name:"Dot life",default:-1},move_distance:{type:e.ParameterType.INT,pretty_name:"Move distance",default:1},aperture_width:{type:e.ParameterType.INT,pretty_name:"Aperture width",default:600},aperture_height:{type:e.ParameterType.INT,pretty_name:"Aperture height",default:400},dot_color:{type:e.ParameterType.STRING,pretty_name:"Dot color",default:"white"},dot_shape:{type:e.ParameterType.STRING,pretty_name:"Dot shape",default:"circle"},background_color:{type:e.ParameterType.STRING,pretty_name:"Background color",default:"gray"},RDK_type:{type:e.ParameterType.INT,pretty_name:"RDK type",default:3},aperture_type:{type:e.ParameterType.INT,pretty_name:"Aperture Type",default:2},reinsert_type:{type:e.ParameterType.INT,pretty_name:"Reinsert type",default:2},aperture_center_x:{type:e.ParameterType.INT,pretty_name:"Aperture center X",default:window.innerWidth/2},aperture_center_y:{type:e.ParameterType.INT,pretty_name:"Aperture center Y",default:window.innerHeight/2},fixation_cross:{type:e.ParameterType.BOOL,pretty_name:"Fixation cross",default:!1},fixation_cross_width:{type:e.ParameterType.INT,pretty_name:"Fixation cross width",default:20},fixation_cross_height:{type:e.ParameterType.INT,pretty_name:"Fixation cross height",default:20},fixation_cross_color:{type:e.ParameterType.STRING,pretty_name:"Fixation cross color",default:"black"},fixation_cross_thickness:{type:e.ParameterType.INT,pretty_name:"Fixation cross thickness",default:1},border:{type:e.ParameterType.BOOL,pretty_name:"Border",default:!1},border_thickness:{type:e.ParameterType.INT,pretty_name:"Border width",default:1},border_color:{type:e.ParameterType.STRING,pretty_name:"Border Color",default:1}}},a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t}var t,o,a;return t=e,o=[{key:"trial",value:function(e,t){var r=this,o=At(t.choices,[]),a=At(t.correct_choice,void 0),n=At(t.trial_duration,500),i=At(t.response_ends_trial,!0),s=At(t.number_of_apertures,1),p=At(t.number_of_dots,300),c=At(t.number_of_sets,1),y=At(t.coherent_direction,0),u=At(t.coherence,.5),d=At(t.opposite_coherence,0),l=At(t.dot_radius,2),h=At(t.dot_side_length,1),_=At(t.dot_life,-1),f=At(t.move_distance,1),m=At(t.aperture_width,600),v=At(t.aperture_height,400),T=At(t.dot_color,"white"),g=At(t.dot_shape,"circle"),M=At(t.background_color,"gray"),w=At(t.RDK_type,3),P=At(t.aperture_type,2),x=At(t.reinsert_type,2),b=At(t.aperture_center_x,window.innerWidth/2),k=At(t.aperture_center_y,window.innerHeight/2),I=At(t.fixation_cross,!1),N=At(t.fixation_cross_width,20),A=At(t.fixation_cross_height,20),C=At(t.fixation_cross_color,"black"),R=At(t.fixation_cross_thickness,1),S=At(t.border,!1),Y=At(t.border_thickness,1),K=At(t.border_color,"black");1!=V&&3!=V||(v=m);var j=s,O=p,D=c,E=y,F=d,X=l,q=h,B=_,L=f,W=m,G=v,H=T,z=M,J=b,Q=k,U=w,V=P,Z=g,$=x,ee=I,te=N,re=A,oe=C,ae=R,ne=Y,ie=K,se=document.createElement("canvas");e.appendChild(se);var pe=document.getElementsByClassName("jspsych-display-element")[0],ce=pe.style.margin,ye=pe.style.padding,ue=pe.style.backgroundColor;pe.style.margin="0",pe.style.padding="0",pe.style.backgroundColor=z,se.style.margin="0",se.style.padding="0",se.style.position="absolute",se.style.top="0",se.style.left="0";var de,le=se.getContext("2d"),he=se.width=window.innerWidth,_e=se.height=window.innerHeight;se.style.backgroundColor=z;var fe,me,ve,Te,ge,Me,we,Pe,xe,be,ke,Ie,Ne,Ae,Ce,Re,Se,Ye,Ke,je,Oe,De,Ee,Fe,Xe,qe,Be,Le,We,Ge,He,ze,Je,Qe,Ue=[];!function(){for(fe=dt(O),me=dt(D),ve=dt(E),Te=dt(u),ge=dt(F),Me=dt(X),we=dt(q),Pe=dt(B),xe=dt(L),be=dt(W),ke=dt(G),Ie=dt(H),Ne=dt(Z),Ae=dt(J),Ce=dt(Q),Re=dt(U),Se=dt(V),Ye=dt($),Ke=dt(ee),je=dt(te),Oe=dt(re),De=dt(oe),Ee=dt(ae),Fe=dt(S),Xe=dt(ne),qe=dt(ie),Qe=dt(0),de=0;de<j;de++)lt(de),Ue.push(ht())}();var Ve,Ze,$e,et,tt=!1,rt=!1,ot={rt:-1,key:""},at=[],nt=0,it=2*Math.PI,st=function(e,t,r){le.arc(e,t,r,0,it)},pt=function(e,t,r){var o=2*r;le.rect(e-r,t-r,o,o)},ct=function(){tt=!0,nt=at.length;var t=at;at=nt>0?at.reduce((function(e,t){return e+t}))/nt:0,void 0!==Ze&&r.jsPsych.pluginAPI.cancelKeyboardResponse(Ze);var j={rt:ot.rt,response:ot.key,correct:ut(),choices:o,correct_choice:a,trial_duration:n,response_ends_trial:i,number_of_apertures:s,number_of_dots:p,number_of_sets:c,coherent_direction:y,coherence:u,opposite_coherence:d,dot_radius:l,dot_side_length:h,dot_life:_,move_distance:f,aperture_width:m,aperture_height:v,dot_color:T,dot_shape:g,background_color:M,RDK_type:w,aperture_type:P,reinsert_type:x,frame_rate:at,frame_rate_array:t,number_of_frames:nt,aperture_center_x:b,aperture_center_y:k,fixation_cross:I,fixation_cross_width:N,fixation_cross_height:A,fixation_cross_color:C,fixation_cross_thickness:R,border:S,border_thickness:Y,border_color:K,canvas_width:he,canvas_height:_e};e.innerHTML="",pe.style.margin=ce,pe.style.padding=ye,pe.style.backgroundColor=ue,r.jsPsych.finishTrial(j)};function yt(e){""==ot.key&&(ot=e),i&&(window.clearTimeout(Ve),ct())}et=window.requestAnimationFrame((function e(){if(tt)window.cancelAnimationFrame(et);else if(et=window.requestAnimationFrame(e),!rt&&n>0&&(Ve=window.setTimeout(ct,n),rt=!0),function(){for(le.clearRect(0,0,se.width,se.height),de=0;de<j;de++)lt(de),mt();for(de=0;de<j;de++)lt(de),ft();!0===ee&&(le.beginPath(),le.lineWidth=ae,le.moveTo(he/2-te,_e/2),le.lineTo(he/2+te,_e/2),le.moveTo(he/2,_e/2-re),le.lineTo(he/2,_e/2+re),le.strokeStyle=oe,le.stroke())}(),void 0===$e)$e=performance.now();else{var t=performance.now();at.push(Math.round(t-$e)),$e=t}})),"NO_KEYS"!=o&&(Ze=r.jsPsych.pluginAPI.getKeyboardResponse({callback_function:yt,valid_responses:o,rt_method:"performance",persist:!1,allow_held_key:!1}));var ut=function(){return void 0!==a&&a.constructor===Array?"string"==typeof a[0]||a[0]instanceof String?a.every((function(e){return r.jsPsych.pluginAPI.compareKeys(e,ot.key)})):(a[0],console.error("Error in RDK plugin: elements in the correct_choice array must be key characters (strings)."),!1):(console.error("Error in RDK plugin: you must specify an array of key characters for the correct_choice parameter."),!1)};function dt(e){if(e.constructor===Array&&e.length===j)return e;if(e.constructor!==Array){for(var t=[],r=0;r<j;r++)t.push(e);return t}e.constructor===Array&&e.length!==j?console.error("If you have more than one aperture, please ensure that arrays that are passed in as parameters are the same length as the number of apertures. Else you can use a single value without the array"):console.error("A parameter is incorrectly set. Please ensure that the nApertures parameter is set to the correct value (if using more than one aperture), and all others parameters are set correctly.")}function lt(e){O=fe[e],D=me[e],E=ve[e],u=Te[e],F=ge[e],X=Me[e],q=we[e],B=Pe[e],L=xe[e],W=be[e],G=ke[e],H=Ie[e],Z=Ne[e],J=Ae[e],Q=Ce[e],U=Re[e],V=Se[e],$=Ye[e],ee=Ke[e],te=je[e],re=Oe[e],oe=De[e],ae=Ee[e],S=Fe[e],ne=Xe[e],ie=qe[e],We=function(e){var t=e*Math.PI/180;return L*Math.cos(t)}(E),Ge=function(e){var t=-e*Math.PI/180;return L*Math.sin(t)}(E),1==V||3==V?Be=Le=W/2:2!=V&&4!=V||(Be=W/2,Le=G/2),He=O*u,ze=O*F,Je=0!==Ue.length?Ue[e]:void 0}function ht(){for(var e=[],t=0;t<D;t++)e.push(_t());return e}function _t(){for(var e=[],t=0;t<O;t++){var r={x:0,y:0,vx:0,vy:0,vx2:0,vy2:0,latestXMove:0,latestYMove:0,lifeCount:Math.floor(Nt(0,B)),updateType:""};r=It(r),1==U&&(t<He?(r=gt(r)).updateType="constant direction":t>=He&&t<He+ze?(r=gt(r)).updateType="opposite direction":r.updateType="random position"),2==U&&(t<He?(r=gt(r)).updateType="constant direction":t>=He&&t<He+ze?(r=gt(r)).updateType="opposite direction":r.updateType="random walk"),3==U&&(t<He?(r=gt(r)).updateType="constant direction":t>=He&&t<He+ze?(r=gt(r)).updateType="opposite direction":(Mt(r),r.updateType="random direction")),4==U&&((r=gt(r)).updateType="constant direction or opposite direction or random position"),5==U&&((r=gt(r)).updateType="constant direction or opposite direction or random walk"),6==U&&(Mt(r=gt(r)),r.updateType="constant direction or opposite direction or random direction"),e.push(r)}return e}function ft(){var e,t,r=Je[Qe[de]];"square"==Z?(e=pt,t=.5*q):(e=st,t=X),le.fillStyle=H,le.beginPath();for(var o=0;o<O;o++){var a=r[o];le.moveTo(a.x+t,a.y),e(a.x,a.y,t)}le.fill(),!0===S&&(1!==V&&2!==V||(le.lineWidth=ne,le.strokeStyle=ie,le.beginPath(),le.ellipse(J,Q,Be+ne/2,Le+ne/2,0,0,it),le.stroke()),3!==V&&4!==V||(le.lineWidth=ne,le.strokeStyle=ie,le.strokeRect(J-Be-ne/2,Q-Le-ne/2,2*Be+ne,2*Le+ne)))}function mt(){Qe[de]==D-1?Qe[de]=0:Qe[de]=Qe[de]+1;for(var e=Je[Qe[de]],t=0;t<O;t++){var r=e[t],o=Math.random();if("constant direction"==r.updateType?r=wt(r):"opposite direction"==r.updateType?r=Pt(r):"random position"==r.updateType?r=It(r):"random walk"==r.updateType?r=xt(r):"random direction"==r.updateType?r=bt(r):"constant direction or opposite direction or random position"==r.updateType?r=o<u?wt(r):o>=u&&o<u+F?Pt(r):It(r):"constant direction or opposite direction or random walk"==r.updateType?r=o<u?wt(r):o>=u&&o<u+F?Pt(r):xt(r):"constant direction or opposite direction or random direction"==r.updateType&&(r=o<u?wt(r):o>=u&&o<u+F?Pt(r):bt(r)),r.lifeCount++,vt(r)&&(r=It(r)),Tt(r))switch($){case 1:r=It(r);break;case 2:r=kt(r)}}}function vt(e){return B<0?(e.lifeCount=0,!1):e.lifeCount>=B&&(e.lifeCount=0,!0)}function Tt(e){return 1==V||2==V?e.x<(r=e.y,r-=Q,-Be*Math.sqrt(1-Math.pow(r,2)/Math.pow(Le,2))+J)||e.x>function(e){return e-=Q,Be*Math.sqrt(1-Math.pow(e,2)/Math.pow(Le,2))+J}(e.y)||e.y<(t=e.x,t-=J,-Le*Math.sqrt(1-Math.pow(t,2)/Math.pow(Be,2))+Q)||e.y>function(e){return e-=J,Le*Math.sqrt(1-Math.pow(e,2)/Math.pow(Be,2))+Q}(e.x):3==V||4==V?e.x<J-Be||e.x>J+Be||e.y<Q-Le||e.y>Q+Le:void 0;var t,r}function gt(e){return e.vx=We,e.vy=Ge,e}function Mt(e){var t=Nt(-Math.PI,Math.PI);return e.vx2=Math.cos(t)*L,e.vy2=-Math.sin(t)*L,e}function wt(e){return e.x+=e.vx,e.y+=e.vy,e.latestXMove=e.vx,e.latestYMove=e.vy,e}function Pt(e){return e.x-=e.vx,e.y-=e.vy,e.latestXMove=-e.vx,e.latestYMove=-e.vy,e}function xt(e){var t=Nt(-Math.PI,Math.PI);return e.latestXMove=Math.cos(t)*L,e.latestYMove=-Math.sin(t)*L,e.x+=e.latestXMove,e.y+=e.latestYMove,e}function bt(e){return e.x+=e.vx2,e.y+=e.vy2,e.latestXMove=e.vx2,e.latestYMove=e.vy2,e}function kt(e){if(1!=V&&2!=V||(e.x-=e.latestXMove,e.y-=e.latestYMove,e.x-=J,e.y-=Q,e.x=-e.x,e.y=-e.y,e.x+=J,e.y+=Q),3==V||4==V){var t=Math.abs(e.latestXMove),r=Math.abs(e.latestYMove),o=Le/(Le+Be)*(t/(t+r));o>(Be/(Le+Be)*(r/(t+r))+o)*Math.random()?e.latestXMove<0?(e.x=J+Be,e.y=Nt(Q-Le,Q+Le)):(e.x=J-Be,e.y=Nt(Q-Le,Q+Le)):e.latestYMove<0?(e.y=Q+Le,e.x=Nt(J-Be,J+Be)):(e.y=Q-Le,e.x=Nt(J-Be,J+Be))}return e}function It(e){if(1==V||2==V){var t=Nt(-Math.PI,Math.PI),r=Math.random(),o=Math.sqrt(r)*Math.cos(t),a=Math.sqrt(r)*Math.sin(t);o=o*Be+J,a=a*Le+Q,e.x=o,e.y=a}else 3!=V&&4!=V||(e.x=Nt(J-Be,J+Be),e.y=Nt(Q-Le,Q+Le));return e}function Nt(e,t){return e+Math.random()*(t-e)}function At(e,t){return void 0!==e?e:t}}}],o&&r(t.prototype,o),a&&r(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();
/**
   * **RDK**
   *
   * jsPsych plugin for showing a random-dot kinematogram stimulus and recording a keyboard response
   *
   * @author Sivananda Rajananda
   * @see {@link https://www.jspsych.org/plugins/jspsych-rdk/ RDK plugin documentation on jspsych.org}
   * @copyright
   *
   * This code was created in the Consciousness and Metacognition Lab at UCLA,
   * under the supervision of Brian Odegaard and Hakwan Lau
   *
   * We would appreciate it if you cited this paper when you use the RDK:
   * Rajananda, S., Lau, H. & Odegaard, B., (2018). A Random-Dot Kinematogram for Web-Based Vision Research. Journal of Open Research Software. 6(1), p.6. DOI: [http://doi.org/10.5334/jors.194]
   *
   * ----------------------
   *
   * Copyright (C) 2017  Sivananda Rajananda
   *
   * This program is free software: you can redistribute it and/or modify
   * it under the terms of the GNU General Public License as published by
   * the Free Software Foundation, either version 3 of the License, or
   * (at your option) any later version.
   *
   * This program is distributed in the hope that it will be useful,
   * but WITHOUT ANY WARRANTY; without even the implied warranty of
   * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   * GNU General Public License for more details.
   *
   * You should have received a copy of the GNU General Public License
   * along with this program.  If not, see <http://www.gnu.org/licenses/>.
   */return a.info=o,a}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
