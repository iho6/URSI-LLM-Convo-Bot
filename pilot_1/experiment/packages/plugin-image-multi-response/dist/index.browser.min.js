var jsPsychImageMultiResponse=function(t){"use strict";function e(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function i(t,i){for(var s=0;s<i.length;s++){var n=i[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,e(n.key),n)}}var s={name:"image-multi-response",parameters:{stimulus:{type:t.ParameterType.IMAGE,pretty_name:"Stimulus",default:void 0},stimulus_height:{type:t.ParameterType.INT,pretty_name:"Image height",default:null},stimulus_width:{type:t.ParameterType.INT,pretty_name:"Image width",default:null},maintain_aspect_ratio:{type:t.ParameterType.BOOL,pretty_name:"Maintain aspect ratio",default:!0},button_choices:{type:t.ParameterType.STRING,pretty_name:"Button Choices",default:[],array:!0},keyboard_choices:{type:t.ParameterType.KEYS,pretty_name:"Keyboard Choices",default:"NO_KEYS"},button_html:{type:t.ParameterType.HTML_STRING,pretty_name:"Button HTML",default:'<button class="jspsych-btn">%choice%</button>',array:!0},prompt:{type:t.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},stimulus_duration:{type:t.ParameterType.INT,pretty_name:"Stimulus duration",default:null},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:null},margin_vertical:{type:t.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px"},margin_horizontal:{type:t.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px"},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},render_on_canvas:{type:t.ParameterType.BOOL,pretty_name:"Render on canvas",default:!0}}},n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.jsPsych=e}var e,s,n;return e=t,s=[{key:"trial",value:function(t,e){var i,s,n,a=this;if(e.render_on_canvas){var r=!1;if(t.hasChildNodes())for(;t.firstChild;)t.removeChild(t.firstChild);var u=document.createElement("canvas");u.id="jspsych-image-multi-response-stimulus",u.style.margin="0",u.style.padding="0";var l=u.getContext("2d");(y=new Image).onload=function(){r||(o(),l.drawImage(y,0,0,s,i))},y.src=e.stimulus;var o=function(){null!==e.stimulus_height?(i=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(s=y.naturalWidth*(e.stimulus_height/y.naturalHeight))):i=y.naturalHeight,null!==e.stimulus_width?(s=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(i=y.naturalHeight*(e.stimulus_width/y.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(s=y.naturalWidth),u.height=i,u.width=s};o();var m=[];if(Array.isArray(e.button_html))e.button_html.length==e.button_choices.length?m=e.button_html:console.error("Error in image-multi-response plugin. The length of the button_html array does not equal the length of the button_choices array");else for(var h=0;h<e.button_choices.length;h++)m.push(e.button_html);var c=document.createElement("div");for(c.id="jspsych-image-multi-response-btngroup",n="",h=0;h<e.button_choices.length;h++){var p=m[h].replace(/%choice%/g,e.button_choices[h]);n+='<div class="jspsych-image-multi-response-button" style="display: inline-block; margin:'+e.margin_vertical+" "+e.margin_horizontal+'" id="jspsych-image-multi-response-button-'+h+'" data-choice="'+h+'">'+p+"</div>"}c.innerHTML=n,t.insertBefore(u,null),y.complete&&Number.isFinite(s)&&Number.isFinite(i)&&(l.drawImage(y,0,0,s,i),r=!0),t.insertBefore(c,u.nextElementSibling),null!==e.prompt&&t.insertAdjacentHTML("beforeend",e.prompt)}else{if(n='<img draggable="false" src="'+e.stimulus+'" id="jspsych-image-multi-response-stimulus">',m=[],Array.isArray(e.button_html))e.button_html.length==e.button_choices.length?m=e.button_html:console.error("Error in image-multi-response plugin. The length of the button_html array does not equal the length of the button_choices array");else for(h=0;h<e.button_choices.length;h++)m.push(e.button_html);for(n+='<div id="jspsych-image-multi-response-btngroup">',h=0;h<e.button_choices.length;h++)p=m[h].replace(/%choice%/g,e.button_choices[h]),n+='<div class="jspsych-image-multi-response-button" style="display: inline-block; margin:'+e.margin_vertical+" "+e.margin_horizontal+'" id="jspsych-image-multi-response-button-'+h+'" data-choice="'+h+'">'+p+"</div>";n+="</div>",null!==e.prompt&&(n+=e.prompt),t.innerHTML=n;var y=t.querySelector("#jspsych-image-multi-response-stimulus");null!==e.stimulus_height?(i=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(s=y.naturalWidth*(e.stimulus_height/y.naturalHeight))):i=y.naturalHeight,null!==e.stimulus_width?(s=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(i=y.naturalHeight*(e.stimulus_width/y.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(s=y.naturalWidth),y.style.height=i.toString()+"px",y.style.width=s.toString()+"px"}if("NO_KEYS"!=e.keyboard_choices)var d=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:function(i){t.querySelector("#jspsych-image-multi-response-stimulus").className+=" responded",null==g.key&&(g=Object.assign({source:"keyboard",button:null},i)),e.response_ends_trial&&b()},valid_responses:e.keyboard_choices,rt_method:"performance",persist:!1,allow_held_key:!1});var _=performance.now();for(h=0;h<e.button_choices.length;h++)t.querySelector("#jspsych-image-multi-response-button-"+h).addEventListener("click",(function(t){f(t.currentTarget.getAttribute("data-choice"))}));var g={rt:null,button:null,key:null,source:null},b=function(){a.jsPsych.pluginAPI.clearAllTimeouts(),void 0!==d&&a.jsPsych.pluginAPI.cancelKeyboardResponse(d);var i={rt:g.rt,stimulus:e.stimulus,button_response:g.button,keyboard_response:g.key,response_source:g.source};t.innerHTML="",a.jsPsych.finishTrial(i)};function f(i){var s=performance.now(),n=Math.round(s-_);g.button=parseInt(i),g.rt=n,g.source="button",t.querySelector("#jspsych-image-multi-response-stimulus").className+=" responded";for(var a=document.querySelectorAll(".jspsych-image-multi-response-button button"),r=0;r<a.length;r++)a[r].setAttribute("disabled","disabled");e.response_ends_trial&&b()}null!==e.stimulus_duration&&this.jsPsych.pluginAPI.setTimeout((function(){t.querySelector("#jspsych-image-multi-response-stimulus").style.visibility="hidden"}),e.stimulus_duration),null!==e.trial_duration?this.jsPsych.pluginAPI.setTimeout(b,e.trial_duration):!1===e.response_ends_trial&&console.warn("The experiment may be deadlocked. Try setting a trial duration or set response_ends_trial to true.")}},{key:"simulate",value:function(t,e,i,s){"data-only"==e&&(s(),this.simulate_data_only(t,i)),"visual"==e&&this.simulate_visual(t,i,s)}},{key:"create_simulation_data",value:function(t,e){var i={stimulus:t.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),keyboard_response:this.jsPsych.pluginAPI.getValidKey(t.keyboard_choices),button_response:null,response_source:"keyboard"},s={stimulus:t.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),button_response:this.jsPsych.randomization.randomInt(0,t.button_choices.length-1),keyboard_response:null,response_source:"button"},n=Math.random()<.5?i:s,a=this.jsPsych.pluginAPI.mergeSimulationData(n,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t,a),a}},{key:"simulate_data_only",value:function(t,e){var i=this.create_simulation_data(t,e);this.jsPsych.finishTrial(i)}},{key:"simulate_visual",value:function(t,e,i){var s=this.create_simulation_data(t,e),n=this.jsPsych.getDisplayElement();this.trial(n,t),i(),null!==s.rt&&(null!==s.button_response?this.jsPsych.pluginAPI.clickTarget(n.querySelector('div[data-choice="'.concat(s.button_response,'"] button')),s.rt):this.jsPsych.pluginAPI.pressKey(s.keyboard_response,s.rt))}}],s&&i(e.prototype,s),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();return n.info=s,n}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
