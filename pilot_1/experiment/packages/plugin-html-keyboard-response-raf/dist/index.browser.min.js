var jsPsychHtmlKeyboardResponseRaf=function(e){"use strict";function t(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function r(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t(i.key),i)}}var n={name:"html-keyboard-response-raf",parameters:{stimulus:{type:e.ParameterType.HTML_STRING,pretty_name:"Stimulus",default:void 0},choices:{type:e.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},stimulus_duration:{type:e.ParameterType.INT,pretty_name:"Stimulus duration",default:null},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:null},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},fps:{type:e.ParameterType.INT,pretty_name:"FPS",default:60}}},i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t,this.hideStimulusFrameCount=1/0,this.endTrialFrameCount=1/0,this.stimulusIsHidden=!1}var t,n,i;return t=e,n=[{key:"trial",value:function(e,t){var r=this,n='<div id="jspsych-html-keyboard-response-stimulus">'+t.stimulus+"</div>";null!==t.prompt&&(n+=t.prompt);var i={rt:null,key:null},a=0;this.currAnimationFrameHandler=requestAnimationFrame((function(){performance.now(),e.innerHTML=n,"NO_KEYS"!=t.choices&&(r.keyboardListener=r.jsPsych.pluginAPI.getKeyboardResponse({callback_function:l,valid_responses:t.choices,rt_method:"performance",persist:!1,allow_held_key:!1})),null!==t.stimulus_duration&&(r.hideStimulusFrameCount=Math.round(t.stimulus_duration/(1e3/t.fps))),null!==t.trial_duration&&(r.endTrialFrameCount=Math.round(t.trial_duration/(1e3/t.fps))),console.log(performance.now()),r.currAnimationFrameHandler=requestAnimationFrame(s)}));var s=function t(){++a>=r.hideStimulusFrameCount&&!r.stimulusIsHidden&&(r.stimulusIsHidden=!0,e.querySelector("#jspsych-html-keyboard-response-stimulus").style.visibility="hidden",console.log(a,performance.now())),a>=r.endTrialFrameCount?(console.log(a,performance.now()),u()):r.currAnimationFrameHandler=requestAnimationFrame(t)},u=function(){cancelAnimationFrame(r.currAnimationFrameHandler),void 0!==r.keyboardListener&&r.jsPsych.pluginAPI.cancelKeyboardResponse(r.keyboardListener);var n={rt:i.rt,stimulus:t.stimulus,response:i.key};e.innerHTML="",r.jsPsych.finishTrial(n)},l=function(r){e.querySelector("#jspsych-html-keyboard-response-stimulus").className+=" responded",null==i.key&&(i=r),t.response_ends_trial&&u()}}},{key:"simulate",value:function(e,t,r,n){"data-only"==t&&(n(),this.simulate_data_only(e,r)),"visual"==t&&this.simulate_visual(e,r,n)}},{key:"create_simulation_data",value:function(e,t){var r={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.pluginAPI.getValidKey(e.choices)},n=this.jsPsych.pluginAPI.mergeSimulationData(r,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,n),n}},{key:"simulate_data_only",value:function(e,t){var r=this.create_simulation_data(e,t);this.jsPsych.finishTrial(r)}},{key:"simulate_visual",value:function(e,t,r){var n=this.create_simulation_data(e,t),i=this.jsPsych.getDisplayElement();this.trial(i,e),r(),null!==n.rt&&this.jsPsych.pluginAPI.pressKey(n.response,n.rt)}}],n&&r(t.prototype,n),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();return i.info=n,i}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
