var jsPsychImageArrayKeyboardResponse=function(t){"use strict";function e(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function i(t,i){for(var a=0;a<i.length;a++){var s=i[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,e(s.key),s)}}var a={name:"image-array-keyboard-response",parameters:{stimulus:{type:t.ParameterType.IMAGE,pretty_name:"Stimulus",default:void 0},stimulus_rect:{type:t.ParameterType.INT,pretty_name:"Image rectangle",default:null},maintain_aspect_ratio:{type:t.ParameterType.BOOL,pretty_name:"Maintain aspect ratio",default:!0},choices:{type:t.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},stimulus_duration:{type:t.ParameterType.INT,pretty_name:"Stimulus duration",default:null},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:null},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},render_on_canvas:{type:t.ParameterType.BOOL,pretty_name:"Render on canvas",default:!0}}},s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.jsPsych=e}var e,a,s;return e=t,a=[{key:"trial",value:function(t,e){var i,a,s=this;if(e.render_on_canvas){var r=[];if(t.hasChildNodes())for(;t.firstChild;)t.removeChild(t.firstChild);var n=document.createElement("canvas");n.id="jspsych-image-keyboard-response-stimulus",n.style.margin="0",n.style.padding="0",n.width=document.body.clientWidth,n.height=document.body.clientHeight;for(var l=n.getContext("2d"),u=function(s){var u=e.stimulus_rect[s][0],o=e.stimulus_rect[s][1],c=new Image;c.onload=function(){(r.length<s||!r[s])&&(m(),l.drawImage(c,u,o,a,i))},c.src=e.stimulus[s];var m=function(){var t=e.stimulus_rect[s][3],r=e.stimulus_rect[s][2];null!==t?(i=t,null==r&&e.maintain_aspect_ratio&&(a=c.naturalWidth*(t/c.naturalHeight))):i=c.naturalHeight,null!==r?(a=r,null==t&&e.maintain_aspect_ratio&&(i=c.naturalHeight*(r/c.naturalWidth))):null!==t&&e.maintain_aspect_ratio||(a=c.naturalWidth)};m(),t.insertBefore(n,null),c.complete&&Number.isFinite(a)&&Number.isFinite(i)&&(l.drawImage(c,u,o,a,i),r[s]=!0)},o=0;o<e.stimulus.length;o++)u(o)}else for(var c=0;c<e.stimulus.length;c++){var m=e.stimulus_rect[c][3],y=e.stimulus_rect[c][2],p=e.stimulus_rect[c][0],d=e.stimulus_rect[c][1];t.innerHTML+='<img src="'+e.stimulus[c]+'" id="jspsych-image-keyboard-response-stimulus-'+c.toString()+'">';var h=t.querySelector("#jspsych-image-keyboard-response-stimulus-"+c.toString());null!==m?(i=m,null==y&&e.maintain_aspect_ratio&&(a=h.naturalWidth*(m/h.naturalHeight))):i=h.naturalHeight,null!==y?(a=y,null==m&&e.maintain_aspect_ratio&&(i=h.naturalHeight*(y/h.naturalWidth))):null!==m&&e.maintain_aspect_ratio||(a=h.naturalWidth),h.style.height=i.toString()+"px",h.style.width=a.toString()+"px",h.style.left=p.toString()+"px",h.style.top=d.toString()+"px",h.style.position="absolute"}var _={rt:null,key:null},f=function(){s.jsPsych.pluginAPI.clearAllTimeouts(),void 0!==g&&s.jsPsych.pluginAPI.cancelKeyboardResponse(g);var i={rt:_.rt,stimulus:e.stimulus,response:_.key};t.innerHTML="",s.jsPsych.finishTrial(i)};if("NO_KEYS"!=e.choices)var g=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:function(i){for(var a;a<e.stimulus.length;a++)t.querySelector("#jspsych-image-keyboard-response-stimulus-"+a.toString()).className+=" responded";null==_.key&&(_=i),e.response_ends_trial&&f()},valid_responses:e.choices,rt_method:"performance",persist:!1,allow_held_key:!1});null!==e.stimulus_duration&&this.jsPsych.pluginAPI.setTimeout((function(){for(var i;i<e.stimulus.length;i++)t.querySelector("#jspsych-image-keyboard-response-stimulus-"+i.toString()).style.visibility="hidden"}),e.stimulus_duration),null!==e.trial_duration?this.jsPsych.pluginAPI.setTimeout((function(){f()}),e.trial_duration):!1===e.response_ends_trial&&console.warn("The experiment may be deadlocked. Try setting a trial duration or set response_ends_trial to true.")}},{key:"simulate",value:function(t,e,i,a){"data-only"==e&&(a(),this.simulate_data_only(t,i)),"visual"==e&&this.simulate_visual(t,i,a)}},{key:"simulate_data_only",value:function(t,e){var i=this.create_simulation_data(t,e);this.jsPsych.finishTrial(i)}},{key:"simulate_visual",value:function(t,e,i){var a=this.create_simulation_data(t,e),s=this.jsPsych.getDisplayElement();this.trial(s,t),i(),null!==a.rt&&this.jsPsych.pluginAPI.pressKey(a.response,a.rt)}},{key:"create_simulation_data",value:function(t,e){var i={stimulus:t.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.pluginAPI.getValidKey(t.choices)},a=this.jsPsych.pluginAPI.mergeSimulationData(i,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t,a),a}}],a&&i(e.prototype,a),s&&i(e,s),Object.defineProperty(e,"prototype",{writable:!1}),t}();return s.info=a,s}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
