{"version":3,"file":"index.browser.min.js","names":["jsPsychExtensionTouchscreenButtons","byteToHex","num","toString","slice","standardColor","color","cvs","document","createElement","height","width","ctx","getContext","fillStyle","fillRect","getImageData","data","stdColorToHex","hex","map","idx","join","Button","a","params","jsPsych","_classCallCheck","div","key","style","css","position_x","position_y","size","type","preset","c","classList","add","col","startsWith","length","boxShadow","left","bottom","lineHeight","innerText","_createClass","value","start_listener","pluginAPI","keyDown","end_listener","keyUp","initialize","b","Promise","resolve","layouts","d","_loop","_slicedToArray","g","f","forEach","el","push","Object","entries","on_start","on_load","display_element","getDisplayElement","keys","layout","buttons","button","addEventListener","bind","appendChild","on_finish","ontouchstart","ontouchend","data_property","info","name","jsPsychModule"],"sources":["../index.js"],"sourcesContent":["var jsPsychExtensionTouchscreenButtons = (function (jspsych) {\n  \"use strict\";\n\n  function byteToHex(num) {\n    // Turns a number (0-255) into a 2-character hex number (00-ff)\n    return (\"0\" + num.toString(16)).slice(-2);\n  }\n\n  function standardColor(color) {\n    let cvs = document.createElement(\"canvas\");\n    cvs.height = 1;\n    cvs.width = 1;\n    let ctx = cvs.getContext(\"2d\");\n    ctx.fillStyle = color;\n    ctx.fillRect(0, 0, 1, 1);\n    return ctx.getImageData(0, 0, 1, 1).data;\n  }\n\n  function stdColorToHex(color) {\n    // Convert any CSS color to a hex representation\n    // Examples:\n    // colorToHex('red')            # '#ff0000'\n    // colorToHex('rgb(255, 0, 0)') # '#ff0000'\n    let hex;\n    hex = [0, 1, 2]\n      .map(function (idx) {\n        return byteToHex(color[idx]);\n      })\n      .join(\"\");\n    return \"#\" + hex;\n  }\n\n  class Button {\n    constructor(params, jsPsych) {\n      this.jsPsych = jsPsych;\n      this.div = document.createElement(\"div\");\n      this.key = (params && params.key) || \"\";\n      let style = (params && params.css) || \"jsTouchButton\";\n      let position_x = params.position_x;\n      if (position_x === undefined) {\n        position_x = 50;\n      }\n      let position_y = params.position_y;\n      if (position_y === undefined) {\n        position_y = 10;\n      }\n      let size = params.size;\n      if (size === undefined) {\n        size = 10;\n      }\n      let type = (params && params.preset) || null;\n\n      let c = null;\n      if (type === \"bottom_left\") {\n        c = \"jsTouchButtonLeftBottom\";\n      } else if (type === \"top_left\") {\n        c = \"jsTouchButtonLeftTop\";\n      } else if (type === \"bottom_right\") {\n        c = \"jsTouchButtonRightBottom\";\n      } else if (type === \"top_right\") {\n        c = \"jsTouchButtonRightTop\";\n      } else if (type === \"left\") {\n        c = \"jsTouchButtonLeft\";\n      } else if (type === \"right\") {\n        c = \"jsTouchButtonRight\";\n      }\n\n      this.div.classList.add(style, c);\n      let col = \"#9999\";\n      if (params.color) {\n        col = params.color;\n        if (!col.startsWith(\"#\")) {\n          col = standardColor(col);\n          col = stdColorToHex(col);\n        }\n        if (col.length === 4) {\n          col += \"9\";\n        } else if (col.length === 7) {\n          col += \"90\";\n        }\n      }\n      this.div.style.boxShadow = \"inset 0 0 0 .5vw \" + col + \", 0 0 0 .5vw \" + col;\n      if (c === null) {\n        if (typeof position_x !== \"string\") {\n          this.div.style.left = position_x + \"%\";\n        } else {\n          this.div.style.left = position_x;\n        }\n        if (typeof position_y !== \"string\") {\n          this.div.style.bottom = position_y + \"%\";\n        } else {\n          this.div.style.bottom = position_y;\n        }\n        if (typeof size !== \"string\") {\n          this.div.style.width = this.div.style.height = this.div.style.lineHeight = size + \"vw\";\n        } else {\n          this.div.style.width = this.div.style.height = this.div.style.lineHeight = size;\n        }\n      }\n      if (params.innerText) {\n        this.div.innerText = params.innerText;\n      }\n      if (params.style) {\n        for (let key in params.style) {\n          this.div.style[key] = params.style[key];\n        }\n      }\n    }\n\n    start_listener() {\n      this.jsPsych.pluginAPI.keyDown(this.key);\n    }\n\n    end_listener() {\n      this.jsPsych.pluginAPI.keyUp(this.key);\n    }\n  }\n\n  /**\n   * **extension-touchscreen-buttons**\n   *\n   * Create an overlay of touch buttons to use jsPsych on mobile devices.\n   *\n   * @author Younes Strittmatter\n   */\n  class jsPsychExtensionTouchscreenButtons {\n    constructor(jsPsych) {\n      this.jsPsych = jsPsych;\n    }\n\n    initialize(params) {\n      return new Promise((resolve, reject) => {\n        this.layouts = {};\n        for (const [key, value] of Object.entries(params)) {\n          this.layouts[key] = [];\n          value.forEach((el) => this.layouts[key].push(new Button(el, this.jsPsych)));\n        }\n        resolve();\n      });\n    }\n\n    on_start(params) {}\n\n    on_load(params) {\n      let display_element = this.jsPsych.getDisplayElement();\n\n      let key = Object.keys(this.layouts)[0];\n      if (params) {\n        key = params.layout;\n      }\n      let buttons = this.layouts[key];\n\n      buttons.forEach((button) => {\n        button.div.addEventListener(\"touchstart\", button.start_listener.bind(button), false);\n        button.div.addEventListener(\"touchend\", button.end_listener.bind(button), false);\n        display_element.appendChild(button.div);\n      });\n    }\n\n    on_finish(params) {\n      for (const [key, value] of Object.entries(this.layouts)) {\n        let buttons = value;\n        buttons.forEach((button) => {\n          button.div.ontouchstart = null;\n          button.div.ontouchend = null;\n        });\n      }\n      return {\n        data_property: \"data_value\",\n      };\n    }\n  }\n\n  jsPsychExtensionTouchscreenButtons.info = {\n    name: \"touchscreen-buttons\",\n  };\n\n  return jsPsychExtensionTouchscreenButtons;\n})(jsPsychModule);\n"],"mappings":"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"}