var jsPsychVideoSeveralKeyboardResponses=function(e){"use strict";function t(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function s(e,s){for(var r=0;r<s.length;r++){var a=s[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,t(a.key),a)}}var r={name:"video-several-keyboard-responses",parameters:{stimulus:{type:e.ParameterType.VIDEO,pretty_name:"Video",default:void 0,array:!0},choices:{type:e.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},width:{type:e.ParameterType.INT,pretty_name:"Width",default:""},height:{type:e.ParameterType.INT,pretty_name:"Height",default:""},autoplay:{type:e.ParameterType.BOOL,pretty_name:"Autoplay",default:!0},controls:{type:e.ParameterType.BOOL,pretty_name:"Controls",default:!1},start:{type:e.ParameterType.FLOAT,pretty_name:"Start",default:null},stop:{type:e.ParameterType.FLOAT,pretty_name:"Stop",default:null},rate:{type:e.ParameterType.FLOAT,pretty_name:"Rate",default:1},trial_ends_after_video:{type:e.ParameterType.BOOL,pretty_name:"End trial after video finishes",default:!1},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:null},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing",default:!0},multiple_responses_allowed:{type:e.ParameterType.BOOL,pretty_name:"Multiple responses allowed",default:!0}}},a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t}var t,r,a;return t=e,r=[{key:"trial",value:function(e,t){var s=this;if(!Array.isArray(t.stimulus))throw new Error("\n        The stimulus property for the video-several-keyboard-responses plugin must be an array\n        of files. See https://www.jspsych.org/latest/plugins/video-several-keyboard-responses/#parameters\n      ");var r="<div>";r+='<video id="jspsych-video-several-keyboard-responses-stimulus"',t.width&&(r+=' width="'+t.width+'"'),t.height&&(r+=' height="'+t.height+'"'),t.autoplay&&null==t.start&&(r+=" autoplay "),t.controls&&(r+=" controls "),null!==t.start&&(r+=' style="visibility: hidden;"'),r+=">";var a=this.jsPsych.pluginAPI.getVideoBuffer(t.stimulus[0]);if(!a)for(var i=0;i<t.stimulus.length;i++){var l=t.stimulus[i];l.indexOf("?")>-1&&(l=l.substring(0,l.indexOf("?")));var n=l.substr(l.lastIndexOf(".")+1);"mov"==(n=n.toLowerCase())&&console.warn("Warning: video-several-keyboard-responses plugin does not reliably support .mov files."),r+='<source src="'+l+'" type="video/'+n+'">'}r+="</video>",r+="</div>",null!==t.prompt&&(r+=t.prompt),e.innerHTML=r;var o=e.querySelector("#jspsych-video-several-keyboard-responses-stimulus");a&&(o.src=a),o.onended=function(){t.trial_ends_after_video&&y(),0!=t.response_allowed_while_playing||t.trial_ends_after_video||s.jsPsych.pluginAPI.getKeyboardResponse({callback_function:d,valid_responses:t.choices,rt_method:"performance",persist:!1,allow_held_key:!1})},o.playbackRate=t.rate,null!==t.start&&(o.pause(),o.onseeked=function(){o.style.visibility="visible",o.muted=!1,t.autoplay?o.play():o.pause(),o.onseeked=function(){}},o.onplaying=function(){o.currentTime=t.start,o.onplaying=function(){}},o.muted=!0,o.play());var u=!1;null!==t.stop&&o.addEventListener("timeupdate",(function(e){o.currentTime>=t.stop&&(t.response_allowed_while_playing||s.jsPsych.pluginAPI.getKeyboardResponse({callback_function:d,valid_responses:t.choices,rt_method:"performance",persist:!1,allow_held_key:!1}),o.pause(),t.trial_ends_after_video&&!u&&(u=!0,y()))}));var p={rt:null,key:null,video_time:null},y=function(){s.jsPsych.pluginAPI.clearAllTimeouts(),s.jsPsych.pluginAPI.cancelAllKeyboardResponses(),e.querySelector("#jspsych-video-several-keyboard-responses-stimulus").pause(),e.querySelector("#jspsych-video-several-keyboard-responses-stimulus").onended=function(){};var r={rt:p.rt,stimulus:t.stimulus,response:p.key,video_time:p.video_time};e.innerHTML="",s.jsPsych.finishTrial(r)},d=function(s){e.querySelector("#jspsych-video-several-keyboard-responses-stimulus").className+=" responded",null==p.key?p=t.multiple_responses_allowed?{rt:[s.rt],key:[s.key],video_time:[o.currentTime]}:{rt:s.rt,key:s.key,video_time:o.currentTime}:t.multiple_responses_allowed&&(p.rt.push(s.rt),p.key.push(s.key),p.video_time.push(o.currentTime)),t.response_ends_trial&&y()};"NO_KEYS"!=t.choices&&t.response_allowed_while_playing&&this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:d,valid_responses:t.choices,rt_method:"performance",persist:t.multiple_responses_allowed,allow_held_key:!1}),null!==t.trial_duration&&this.jsPsych.pluginAPI.setTimeout(y,t.trial_duration)}},{key:"simulate",value:function(e,t,s,r){"data-only"==t&&(r(),this.simulate_data_only(e,s)),"visual"==t&&this.simulate_visual(e,s,r)}},{key:"simulate_data_only",value:function(e,t){var s=this.create_simulation_data(e,t);this.jsPsych.finishTrial(s)}},{key:"simulate_visual",value:function(e,t,s){var r=this,a=this.create_simulation_data(e,t),i=this.jsPsych.getDisplayElement();this.trial(i,e),s();var l=i.querySelector("#jspsych-video-button-response-stimulus"),n=function(){null!==a.rt&&r.jsPsych.pluginAPI.pressKey(a.response,a.rt)};e.response_allowed_while_playing?n():l.addEventListener("ended",n)}},{key:"create_simulation_data",value:function(e,t){var s={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.pluginAPI.getValidKey(e.choices),video_time:0},r=this.jsPsych.pluginAPI.mergeSimulationData(s,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,r),r}}],r&&s(t.prototype,r),a&&s(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();return a.info=r,a}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
