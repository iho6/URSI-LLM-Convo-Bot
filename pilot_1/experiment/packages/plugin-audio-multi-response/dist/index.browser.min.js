var jsPsychAudioMultiResponse=function(e){"use strict";function t(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function n(e,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,t(o.key),o)}}var r={name:"audio-multi-response",parameters:{stimulus:{type:e.ParameterType.HTML_STRING,pretty_name:"Stimulus",default:void 0},button_choices:{type:e.ParameterType.STRING,pretty_name:"Button Choices",default:[],array:!0},keyboard_choices:{type:e.ParameterType.KEYS,pretty_name:"Keyboard Choices",default:"NO_KEYS"},button_html:{type:e.ParameterType.HTML_STRING,pretty_name:"Button HTML",default:'<button class="jspsych-btn">%choice%</button>',array:!0},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},prompt_above_buttons:{type:e.ParameterType.BOOL,pretty_name:"Prompt above buttons",default:!1},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:null},margin_vertical:{type:e.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px"},margin_horizontal:{type:e.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px"},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},trial_ends_after_audio:{type:e.ParameterType.BOOL,pretty_name:"Trial ends after audio",default:!1},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing",default:!0}}},o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t}var t,r,o;return t=e,r=[{key:"trial",value:function(e,t,n){var r,o,a=this,i=this.jsPsych.pluginAPI.audioContext(),s={rt:null,key:null,button:null,source:null};this.jsPsych.pluginAPI.getAudioBuffer(t.stimulus).then((function(e){null!==i?(a.audio=i.createBufferSource(),a.audio.buffer=e,a.audio.connect(i.destination)):(a.audio=e,a.audio.currentTime=0),u()})).catch((function(e){console.error('Failed to load audio file "'.concat(t.stimulus,'". Try checking the file path. We recommend using the preload plugin to load audio files.')),console.error(e)}));var u=function(){t.trial_ends_after_audio&&a.audio.addEventListener("ended",l),t.response_allowed_while_playing||t.trial_ends_after_audio||(a.audio.addEventListener("ended",m),a.audio.addEventListener("ended",p));var r=[];if(Array.isArray(t.button_html))t.button_html.length==t.button_choices.length?r=t.button_html:console.error("Error in audio-multi-response plugin. The length of the button_html array does not equal the length of the choices array");else for(var s=0;s<t.button_choices.length;s++)r.push(t.button_html);var u='<div id="jspsych-audio-multi-response-btngroup">';for(s=0;s<t.button_choices.length;s++){var c=r[s].replace(/%choice%/g,t.button_choices[s]);u+='<div class="jspsych-audio-multi-response-button" style="cursor: pointer; display: inline-block; margin:'+t.margin_vertical+" "+t.margin_horizontal+'" id="jspsych-audio-multi-response-button-'+s+'" data-choice="'+s+'">'+c+"</div>"}u+="</div>",null!==t.prompt&&(t.prompt_above_buttons?u='<div id="jspsych-audio-multi-response-prompt">'+t.prompt+"</div>"+u:u+='<div id="jspsych-audio-multi-response-prompt">'+t.prompt+"</div>"),e.innerHTML=u,t.response_allowed_while_playing?(p(),m()):d(),o=performance.now(),null!==i?(o=i.currentTime,a.audio.start(o)):a.audio.play(),null!==t.trial_duration&&a.jsPsych.pluginAPI.setTimeout((function(){l()}),t.trial_duration),n()},l=function n(){a.jsPsych.pluginAPI.clearAllTimeouts(),null!==i?a.audio.stop():a.audio.pause(),a.audio.removeEventListener("ended",n),a.audio.removeEventListener("ended",m),a.audio.removeEventListener("ended",p),a.jsPsych.pluginAPI.cancelAllKeyboardResponses();var o={rt:s.rt,stimulus:t.stimulus,keyboard_response:s.key,button_response:s.button,response_source:s.source};e.innerHTML="",a.jsPsych.finishTrial(o),r()};function c(e){!function(e){var n=performance.now(),r=Math.round(n-o);null!==i&&(n=i.currentTime,r=Math.round(1e3*(n-o))),s.button=parseInt(e),s.rt=r,s.source="button",d(),t.response_ends_trial&&l()}(e.currentTarget.getAttribute("data-choice"))}function d(){for(var e=document.querySelectorAll(".jspsych-audio-multi-response-button"),t=0;t<e.length;t++){var n=e[t].querySelector("button");n&&(n.disabled=!0),e[t].removeEventListener("click",c)}}function p(){for(var e=document.querySelectorAll(".jspsych-audio-multi-response-button"),t=0;t<e.length;t++){var n=e[t].querySelector("button");n&&(n.disabled=!1),e[t].addEventListener("click",c)}}var y=function(e){null==s.key&&(s=Object.assign({source:"keyboard",button:null},e)),t.response_ends_trial&&l()},m=function(){var e;"NO_KEYS"!=t.keyboard_choices&&(e=null!==i?{rt_method:"audio",audio_context:i,audio_context_start_time:o}:{rt_method:"performance"},a.jsPsych.pluginAPI.getKeyboardResponse(Object.assign({callback_function:y,valid_responses:t.keyboard_choices,persist:!1,allow_held_key:!1},e)))};return new Promise((function(e){r=e}))}},{key:"simulate",value:function(e,t,n,r){"data-only"==t&&(r(),this.simulate_data_only(e,n)),"visual"==t&&this.simulate_visual(e,n,r)}},{key:"create_simulation_data",value:function(e,t){var n={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),keyboard_response:this.jsPsych.pluginAPI.getValidKey(e.keyboard_choices),button_response:null,response_source:"keyboard"},r={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),button_response:this.jsPsych.randomization.randomInt(0,e.button_choices.length-1),keyboard_response:null,response_source:"button"},o=Math.random()<.5?n:r,a=this.jsPsych.pluginAPI.mergeSimulationData(o,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,a),a}},{key:"simulate_data_only",value:function(e,t){var n=this.create_simulation_data(e,t);this.jsPsych.finishTrial(n)}},{key:"simulate_visual",value:function(e,t,n){var r=this,o=this.create_simulation_data(e,t),a=this.jsPsych.getDisplayElement(),i=function(){null!==o.rt&&(null!==o.button_response?r.jsPsych.pluginAPI.clickTarget(a.querySelector('div[data-choice="'.concat(o.response,'"] button')),o.rt):r.jsPsych.pluginAPI.pressKey(o.keyboard_response,o.rt))};this.trial(a,e,(function(){n(),e.response_allowed_while_playing?i():r.audio.addEventListener("ended",i)}))}}],r&&n(t.prototype,r),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();return o.info=r,o}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
