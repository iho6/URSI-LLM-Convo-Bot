{"version":3,"file":"index.cjs","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychExtension, JsPsychExtensionInfo } from \"jspsych\";\n\ninterface OnStartParameters {\n  format: (time: number) => string;\n  time: number;\n  update_time: number;\n}\n\n/**\n * **Extension-Countdown**\n *\n * jsPsych extension for adding a countdown for a trial\n *\n * @author Shaobin Jiang\n */\nclass CountdownExtension implements JsPsychExtension {\n  static info: JsPsychExtensionInfo = {\n    name: \"countdown\",\n  };\n\n  constructor(private jsPsych: JsPsych) {}\n\n  private format: (time: number) => string;\n  private time: number;\n  private update_time: number;\n\n  private countdown_element: HTMLElement;\n  private timer: number;\n  private last_recorded_time: number;\n  private time_elapsed: number = 0;\n  private is_running: boolean = true;\n\n  initialize = (): Promise<void> => {\n    return new Promise((resolve, _) => {\n      resolve();\n    });\n  };\n\n  on_start = ({\n    format = (time: number) => String(Math.floor(time / 1000)),\n    time,\n    update_time = 50,\n  }: OnStartParameters): void => {\n    this.format = format;\n    this.time = time;\n    this.update_time = update_time;\n\n    this.time_elapsed = 0;\n\n    this.countdown_element = document.createElement(\"div\");\n    this.countdown_element.innerHTML = this.format(time);\n    this.countdown_element.className = \"jspsych-extension-countdown\";\n    this.countdown_element.style.cssText = \"font-size: 18px; position: fixed; top: 5%; right: 5%;\";\n  };\n\n  on_load = (): void => {\n    this.jsPsych.getDisplayContainerElement().appendChild(this.countdown_element);\n    this.last_recorded_time = performance.now();\n    this.timer = window.setInterval(() => {\n      let now: number = performance.now();\n      if (this.is_running) {\n        this.time_elapsed += now - this.last_recorded_time;\n      }\n      this.last_recorded_time = now;\n      let time_left = this.time - this.time_elapsed;\n      if (time_left <= 0) {\n        window.clearInterval(this.timer);\n      } else {\n        this.countdown_element.innerHTML = this.format(time_left);\n      }\n    }, this.update_time);\n  };\n\n  on_finish = () => {\n    window.clearInterval(this.timer);\n    this.countdown_element.remove();\n    return {};\n  };\n\n  pause = (): void => {\n    this.is_running = false;\n  };\n\n  resume = (): void => {\n    this.is_running = true;\n  };\n\n  get_time_left = (): number => {\n    return this.time - this.time_elapsed;\n  };\n}\n\nexport default CountdownExtension;\n"],"names":[],"mappings":"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"}