{"version":3,"file":"index.browser.min.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychExtension, JsPsychExtensionInfo } from \"jspsych\";\n\ninterface OnStartParameters {\n  format: (time: number) => string;\n  time: number;\n  update_time: number;\n}\n\n/**\n * **Extension-Countdown**\n *\n * jsPsych extension for adding a countdown for a trial\n *\n * @author Shaobin Jiang\n */\nclass CountdownExtension implements JsPsychExtension {\n  static info: JsPsychExtensionInfo = {\n    name: \"countdown\",\n  };\n\n  constructor(private jsPsych: JsPsych) {}\n\n  private format: (time: number) => string;\n  private time: number;\n  private update_time: number;\n\n  private countdown_element: HTMLElement;\n  private timer: number;\n  private last_recorded_time: number;\n  private time_elapsed: number = 0;\n  private is_running: boolean = true;\n\n  initialize = (): Promise<void> => {\n    return new Promise((resolve, _) => {\n      resolve();\n    });\n  };\n\n  on_start = ({\n    format = (time: number) => String(Math.floor(time / 1000)),\n    time,\n    update_time = 50,\n  }: OnStartParameters): void => {\n    this.format = format;\n    this.time = time;\n    this.update_time = update_time;\n\n    this.time_elapsed = 0;\n\n    this.countdown_element = document.createElement(\"div\");\n    this.countdown_element.innerHTML = this.format(time);\n    this.countdown_element.className = \"jspsych-extension-countdown\";\n    this.countdown_element.style.cssText = \"font-size: 18px; position: fixed; top: 5%; right: 5%;\";\n  };\n\n  on_load = (): void => {\n    this.jsPsych.getDisplayContainerElement().appendChild(this.countdown_element);\n    this.last_recorded_time = performance.now();\n    this.timer = window.setInterval(() => {\n      let now: number = performance.now();\n      if (this.is_running) {\n        this.time_elapsed += now - this.last_recorded_time;\n      }\n      this.last_recorded_time = now;\n      let time_left = this.time - this.time_elapsed;\n      if (time_left <= 0) {\n        window.clearInterval(this.timer);\n      } else {\n        this.countdown_element.innerHTML = this.format(time_left);\n      }\n    }, this.update_time);\n  };\n\n  on_finish = () => {\n    window.clearInterval(this.timer);\n    this.countdown_element.remove();\n    return {};\n  };\n\n  pause = (): void => {\n    this.is_running = false;\n  };\n\n  resume = (): void => {\n    this.is_running = true;\n  };\n\n  get_time_left = (): number => {\n    return this.time - this.time_elapsed;\n  };\n}\n\nexport default CountdownExtension;\n"],"names":["CountdownExtension","_createClass","jsPsych","_this","this","_classCallCheck","time_elapsed","is_running","initialize","Promise","resolve","_","on_start","_ref","_ref$format","format","time","String","Math","floor","_ref$update_time","update_time","countdown_element","document","createElement","innerHTML","className","style","cssText","on_load","getDisplayContainerElement","appendChild","last_recorded_time","performance","now","timer","window","setInterval","time_left","clearInterval","on_finish","remove","pause","resume","get_time_left","info","name"],"mappings":"mpBAeMA,IAAAA,EAAkBC,GAKtB,SAAAD,EAAoBE,GAAgB,IAAAC,EAAAC,kGAAAC,MAAAL,GAAhBI,KAAOF,QAAPA,EASZE,KAAYE,aAAW,EACvBF,KAAUG,YAAY,EAE9BH,KAAUI,WAAG,WACX,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC3BD,GACF,KAGFN,KAAAQ,SAAW,SAAAC,GAImB,IAAAC,EAAAD,EAH5BE,OAAAA,OAAS,IAAHD,EAAG,SAACE,GAAY,OAAKC,OAAOC,KAAKC,MAAMH,EAAO,KAAM,EAAAF,EAC1DE,EAAIH,EAAJG,KAAII,EAAAP,EACJQ,YAAAA,OAAc,IAAHD,EAAG,GAAEA,EAEhBjB,EAAKY,OAASA,EACdZ,EAAKa,KAAOA,EACZb,EAAKkB,YAAcA,EAEnBlB,EAAKG,aAAe,EAEpBH,EAAKmB,kBAAoBC,SAASC,cAAc,OAChDrB,EAAKmB,kBAAkBG,UAAYtB,EAAKY,OAAOC,GAC/Cb,EAAKmB,kBAAkBI,UAAY,8BACnCvB,EAAKmB,kBAAkBK,MAAMC,QAAU,yDAGzCxB,KAAOyB,QAAG,WACR1B,EAAKD,QAAQ4B,6BAA6BC,YAAY5B,EAAKmB,mBAC3DnB,EAAK6B,mBAAqBC,YAAYC,MACtC/B,EAAKgC,MAAQC,OAAOC,aAAY,WAC9B,IAAIH,EAAcD,YAAYC,MAC1B/B,EAAKI,aACPJ,EAAKG,cAAgB4B,EAAM/B,EAAK6B,oBAElC7B,EAAK6B,mBAAqBE,EAC1B,IAAII,EAAYnC,EAAKa,KAAOb,EAAKG,aAC7BgC,GAAa,EACfF,OAAOG,cAAcpC,EAAKgC,OAE1BhC,EAAKmB,kBAAkBG,UAAYtB,EAAKY,OAAOuB,EAEnD,GAAGnC,EAAKkB,cAGVjB,KAASoC,UAAG,WAGV,OAFAJ,OAAOG,cAAcpC,EAAKgC,OAC1BhC,EAAKmB,kBAAkBmB,SAChB,IAGTrC,KAAKsC,MAAG,WACNvC,EAAKI,YAAa,GAGpBH,KAAMuC,OAAG,WACPxC,EAAKI,YAAa,GAGpBH,KAAawC,cAAG,WACd,OAAOzC,EAAKa,KAAOb,EAAKG,aApEa,WAJhCN,EAAA6C,KAA6B,CAClCC,KAAM"}