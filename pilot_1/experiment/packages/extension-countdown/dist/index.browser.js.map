{"version":3,"file":"index.browser.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychExtension, JsPsychExtensionInfo } from \"jspsych\";\n\ninterface OnStartParameters {\n  format: (time: number) => string;\n  time: number;\n  update_time: number;\n}\n\n/**\n * **Extension-Countdown**\n *\n * jsPsych extension for adding a countdown for a trial\n *\n * @author Shaobin Jiang\n */\nclass CountdownExtension implements JsPsychExtension {\n  static info: JsPsychExtensionInfo = {\n    name: \"countdown\",\n  };\n\n  constructor(private jsPsych: JsPsych) {}\n\n  private format: (time: number) => string;\n  private time: number;\n  private update_time: number;\n\n  private countdown_element: HTMLElement;\n  private timer: number;\n  private last_recorded_time: number;\n  private time_elapsed: number = 0;\n  private is_running: boolean = true;\n\n  initialize = (): Promise<void> => {\n    return new Promise((resolve, _) => {\n      resolve();\n    });\n  };\n\n  on_start = ({\n    format = (time: number) => String(Math.floor(time / 1000)),\n    time,\n    update_time = 50,\n  }: OnStartParameters): void => {\n    this.format = format;\n    this.time = time;\n    this.update_time = update_time;\n\n    this.time_elapsed = 0;\n\n    this.countdown_element = document.createElement(\"div\");\n    this.countdown_element.innerHTML = this.format(time);\n    this.countdown_element.className = \"jspsych-extension-countdown\";\n    this.countdown_element.style.cssText = \"font-size: 18px; position: fixed; top: 5%; right: 5%;\";\n  };\n\n  on_load = (): void => {\n    this.jsPsych.getDisplayContainerElement().appendChild(this.countdown_element);\n    this.last_recorded_time = performance.now();\n    this.timer = window.setInterval(() => {\n      let now: number = performance.now();\n      if (this.is_running) {\n        this.time_elapsed += now - this.last_recorded_time;\n      }\n      this.last_recorded_time = now;\n      let time_left = this.time - this.time_elapsed;\n      if (time_left <= 0) {\n        window.clearInterval(this.timer);\n      } else {\n        this.countdown_element.innerHTML = this.format(time_left);\n      }\n    }, this.update_time);\n  };\n\n  on_finish = () => {\n    window.clearInterval(this.timer);\n    this.countdown_element.remove();\n    return {};\n  };\n\n  pause = (): void => {\n    this.is_running = false;\n  };\n\n  resume = (): void => {\n    this.is_running = true;\n  };\n\n  get_time_left = (): number => {\n    return this.time - this.time_elapsed;\n  };\n}\n\nexport default CountdownExtension;\n"],"names":[],"mappings":"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"}