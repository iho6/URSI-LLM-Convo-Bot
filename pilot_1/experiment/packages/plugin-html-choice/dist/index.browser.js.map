{"version":3,"file":"index.browser.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nconst info = <const>{\n  name: \"html-choice\",\n  parameters: {\n    /** The HTML string to be displayed */\n    html_array: {\n      type: ParameterType.HTML_STRING,\n      pretty_name: \"Stimulus\",\n      default: undefined,\n    },\n    /** How long to show the stimulus. */\n    stimulus_duration: {\n      type: ParameterType.INT,\n      pretty_name: \"Stimulus duration\",\n      default: null,\n    },\n    /** How long the trial lasts. */\n    trial_duration: {\n      type: ParameterType.INT,\n      pretty_name: \"Trial duration\",\n      default: null,\n    },\n    /** If true, trial will end when subject makes a response. */\n    response_ends_trial: {\n      type: ParameterType.BOOL,\n      pretty_name: \"Response ends trial\",\n      default: true,\n    },\n    /** values that can be assigned to choices. */\n    values: {\n      type: ParameterType.STRING,\n      pretty_name: \"Values\",\n      default: null,\n    },\n    /** Time the stimulus is shown after response (for example for animated feedback). */\n    time_after_response: {\n      type: ParameterType.INT,\n      pretty_name: \"Time after response\",\n      default: 0,\n    },\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * html-choice\n * jsPsych plugin for displaying a stimulus and getting a choice\n * @author Younes Strittmatter\n */\nclass HtmlChoicePlugin implements JsPsychPlugin<Info> {\n  static info = info;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    // check values:\n    let values;\n    if (!trial.values) {\n      values = Array(trial.html_array.length).fill(null);\n    } else if (trial.values.length === trial.html_array.length) {\n      values = trial.values;\n    } else {\n      throw new Error(\"array of html-choices does not have the same length as array of valuse\");\n    }\n    // display stimulus\n    var html = \"<div>\";\n    for (var i = 0; i < trial.html_array.length; i++) {\n      html +=\n        '<div class= \"jspsych-html-choice\" id=\"jspsych-html-choice-' +\n        i +\n        '\" data-choice=' +\n        i +\n        \" value=\" +\n        values[i] +\n        \">\";\n      html += trial.html_array[i];\n      html += \"</div>\";\n    }\n    html += \"</div>\";\n    display_element.innerHTML = html;\n\n    // start time\n    var start_time = performance.now();\n\n    // add event listeners to buttons\n    for (let i = 0; i < trial.html_array.length; i++) {\n      display_element.querySelector(\"#jspsych-html-choice-\" + i).addEventListener(\"click\", (e) => {\n        let element = e.currentTarget as HTMLElement;\n        let choice = element.getAttribute(\"data-choice\"); // don't use dataset for jsdom compatibility\n        let value = element.getAttribute(\"value\");\n        after_response(choice, value);\n      });\n    }\n\n    // store response\n    var response = {\n      rt: null,\n      choice: null,\n      value: null,\n    };\n\n    // function to end trial when it is time\n    const end_trial = () => {\n      // kill any remaining setTimeout handlers\n      this.jsPsych.pluginAPI.clearAllTimeouts();\n\n      // gather the data to store for the trial\n      var trial_data = {\n        rt: response.rt,\n        stimulus: trial.html_array,\n        response: response.choice,\n        value: response.value,\n      };\n\n      // clear the display\n      display_element.innerHTML = \"\";\n\n      // move on to the next trial\n      this.jsPsych.finishTrial(trial_data);\n    };\n\n    // function to handle responses by the subject\n    const after_response = (choice, value) => {\n      // measure rt\n      var end_time = performance.now();\n      var rt = Math.round(end_time - start_time);\n      response.choice = parseInt(choice);\n      response.value = parseInt(value);\n      response.rt = rt;\n\n      // after a valid response, the stimulus will have the CSS class 'responded'\n      // which can be used to provide visual feedback that a response was recorded\n      display_element.querySelector(\"#jspsych-html-choice-\" + choice).className += \" responded\";\n\n      // disable all the buttons after a response\n      let elements = document.querySelectorAll(\".jspsych-html-choice\");\n      for (var i = 0; i < elements.length; i++) {\n        //btns[i].removeEventListener('click');\n        let el = elements[i] as HTMLElement;\n        el.style.pointerEvents = \"none\";\n      }\n\n      if (trial.response_ends_trial) {\n        this.jsPsych.pluginAPI.clearAllTimeouts();\n        this.jsPsych.pluginAPI.setTimeout(end_trial, trial.time_after_response);\n      }\n    };\n\n    // hide image if timing is set\n    if (trial.stimulus_duration !== null) {\n      this.jsPsych.pluginAPI.setTimeout(() => {\n        display_element.querySelector<HTMLElement>(\n          \"#jspsych-html-button-response-stimulus\"\n        ).style.visibility = \"hidden\";\n      }, trial.stimulus_duration);\n    }\n\n    // end trial if time limit is set\n    if (trial.trial_duration !== null) {\n      this.jsPsych.pluginAPI.setTimeout(end_trial, trial.trial_duration);\n    }\n  }\n}\n\nexport default HtmlChoicePlugin;\n"],"names":["ParameterType"],"mappings":"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"}