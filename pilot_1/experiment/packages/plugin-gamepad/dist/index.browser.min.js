var jsPsychGamepad=function(t){"use strict";function e(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var n=a.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,a){for(var n=0;n<a.length;n++){var r=a[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,e(r.key),r)}}function r(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function o(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(t){if("string"==typeof t)return i(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,d=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){d=!0,o=t},f:function(){try{s||null==a.return||a.return()}finally{if(d)throw o}}}}var s=function(){function t(e,n,r){a(this,t),this.gamepad=e,this.size=r,this.draw_call_list=[],this.draw_outline=function(t){},this.canvas=document.createElement("canvas"),this.canvas.width=this.size,this.canvas.height=this.size,this.canvas.style.width="100%",n.appendChild(this.canvas),this.context=this.canvas.getContext("2d",{willReadFrequently:!0})}return r(t,[{key:"draw_component",value:function(t,e,a){var n=this;t instanceof Path2D?this.draw_call_list.push((function(){var e;n.context.save(),n.context.fillStyle="rgba(0, 0, 0, ".concat(null===(e=n.gamepad.buttons[a])||void 0===e?void 0:e.value,")"),n.context.lineWidth=3,n.context.stroke(t),n.context.fill(t),n.context.restore()})):this.draw_call_list.push((function(){var r,i=-1===e?0:n.gamepad.axes[2*e],o=-1===e?0:n.gamepad.axes[2*e+1],s=new Path2D;s.arc(t.x+i*t.radius/2,t.y+o*t.radius/2,t.radius,0,2*Math.PI),n.context.stroke(s),n.context.save(),n.context.fillStyle="rgba(0, 0, 0, ".concat(null===(r=n.gamepad.buttons[a])||void 0===r?void 0:r.value,")"),n.context.lineWidth=3,n.context.stroke(s),n.context.fill(s),n.context.restore()}))}},{key:"update",value:function(t){null!==t&&(this.gamepad=t),this.context.clearRect(0,0,this.size,this.size),this.draw_outline(this.context);var e,a=o(this.draw_call_list);try{for(a.s();!(e=a.n()).done;){(0,e.value)()}}catch(t){a.e(t)}finally{a.f()}}}]),t}(),d={"Xbox 360 Controller (XInput STANDARD GAMEPAD)":function(t,e){var a=new s(t,e,441);return a.draw_outline=function(t){t.save(),t.lineWidth=3;var e=new Path2D("M220.5 323.5L150 323.5C105 323.5 81.5 407.5 49.5 407.5C17.5 407.5 4 392.9 4 346.5C4 300.1 43.5 194.5 55 166.5C66.5 138.5 95.5 121 128 121L220.5 121"),a=new Path2D("M220.5 323.5L291 323.5C336 323.5 359.5 407.5 391.5 407.5C423.5 407.5 437 392.9 437 346.5C437 300.1 397.5 194.5 386 166.5C374.5 138.5 345.5 121 313 121L220.5 121");t.stroke(e),t.stroke(a);var n=new Path2D;n.arc(113,189,37.5,0,2*Math.PI),t.stroke(n);var r=new Path2D;r.arc(278,267,37.5,0,2*Math.PI),t.stroke(r);var i=new Path2D;i.arc(163,267,37.5,0,2*Math.PI),t.stroke(i),t.restore()},a.draw_component({x:113,y:189,radius:30},0,10),a.draw_component({x:278,y:267,radius:30},1,11),a.draw_component({x:328,y:207,radius:8},-1,0),a.draw_component({x:346,y:189,radius:8},-1,1),a.draw_component({x:310,y:189,radius:8},-1,2),a.draw_component({x:328,y:171,radius:8},-1,3),a.draw_component(new Path2D("M111.5 90.5L152.5 90.5C160 90.5 160 103.5 152.5 103.5L111.5 103.5C104 103.5 104 90.5 111.5 90.5"),-1,4),a.draw_component(new Path2D("M329.5 90.5L288.5 90.5C281 90.5 281 103.5 288.5 103.5L329.5 103.5C337 103.5 337 90.5 329.5 90.5"),-1,5),a.draw_component(new Path2D("M152.5 66C152.5 70 149 73.5 145 73.5H132C128 73.5 124.5 70 124.5 66V45.5C124.5 38 131 31.5 138.5 31.5C146 31.5 152.5 38 152.5 45.5V66Z"),-1,6),a.draw_component(new Path2D("M288.5 66C289.5 70 292 73.5 296 73.5H309C313 73.5 316.5 70 316.5 66V45.5C316.5 38 310 31.5 302.5 31.5C295 31.5 288.5 38 288.5 45.5V66Z"),-1,7),a.draw_component({x:185,y:191,radius:8},-1,8),a.draw_component({x:259,y:191,radius:8},-1,9),a.draw_component({x:163,y:249,radius:8},-1,12),a.draw_component({x:163,y:285,radius:8},-1,13),a.draw_component({x:145,y:267,radius:8},-1,14),a.draw_component({x:181,y:267,radius:8},-1,15),a}},c={name:"jspsych-gamepad",parameters:{canvas_size:{type:t.ParameterType.INT,default:[500,500],array:!0},display_minature_gamepad:{type:t.ParameterType.BOOL,default:!1},end_trial:{type:t.ParameterType.FUNCTION,default:function(t,e,a,n){return a>2e3}},gamepad_connection_prompt:{type:t.ParameterType.STRING,default:"Awaiting gamepad connection..."},on_frame_update:{type:t.ParameterType.FUNCTION,default:function(t,e,a,n){}},stimulus:{type:t.ParameterType.FUNCTION,default:function(t){}}}},m=function(){function t(e){a(this,t),this.jsPsych=e,this.gamepad_is_connected=!1,this.minature_gamepad=null,this.start_time_stamp=0,this.last_frame_time_stamp=0,this.animation_frame_id=-1,this.frame_request_callback=function(t){},this.gamepad_inputs=[]}return r(t,[{key:"find_gamepad",value:function(){var t;this.gamepad=null,this.gamepad_is_connected=!1;var e,a=o(navigator.getGamepads());try{for(a.s();!(e=a.n()).done;){var n=e.value;if(n instanceof Gamepad){var r=null===(t=this.gamepad)||void 0===t?void 0:t.id;this.gamepad=n,this.gamepad_is_connected=!0,n.id!==r&&(this.minature_gamepad_wrapper.innerHTML="",this.minature_gamepad=d[n.id](n,this.minature_gamepad_wrapper));break}}}catch(t){a.e(t)}finally{a.f()}}},{key:"trial",value:function(t,e,a){var n=this,r=document.createElement("canvas");r.width=e.canvas_size[0],r.height=e.canvas_size[1];var i=document.createElement("p");i.style.textAlign="center",i.innerHTML=e.gamepad_connection_prompt,t.appendChild(r),t.appendChild(i),this.minature_gamepad_wrapper=document.createElement("div"),this.minature_gamepad_wrapper.id="gamepad-model-wrapper",this.minature_gamepad_wrapper.style.width="10%",this.minature_gamepad_wrapper.style.position="absolute",this.jsPsych.getDisplayContainerElement().appendChild(this.minature_gamepad_wrapper);var o=r.getContext("2d",{willReadFrequently:!0}),s=e.stimulus(o);(s instanceof Promise?s:Promise.resolve(s)).then((function(){var t=o.getImageData(0,0,r.width,r.height);n.frame_request_callback=function(a){var r;0===n.start_time_stamp&&(n.start_time_stamp=a),n.find_gamepad(),i.style.visibility=n.gamepad_is_connected?"hidden":"";var s=a-n.start_time_stamp,c=0===n.last_frame_time_stamp?0:a-n.last_frame_time_stamp;o.putImageData(t,0,0),e.on_frame_update(o,n.gamepad,s,c),e.display_minature_gamepad&&null!==n.minature_gamepad_wrapper&&(null===(r=n.minature_gamepad)||void 0===r||r.update(n.gamepad)),n.gamepad_inputs.push(n.gamepad),e.end_trial(o,n.gamepad,s,c)&&d({rt:s,input:n.gamepad_inputs}),n.last_frame_time_stamp=a,n.animation_frame_id=window.requestAnimationFrame(n.frame_request_callback)},a(),n.animation_frame_id=window.requestAnimationFrame(n.frame_request_callback)}));var d=function(e){window.cancelAnimationFrame(n.animation_frame_id),t.innerHTML="",n.minature_gamepad_wrapper.remove(),n.jsPsych.finishTrial(e)}}}]),t}();return m.info=c,m}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
