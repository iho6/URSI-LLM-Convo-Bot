var jsPsychRok=function(t){"use strict";function e(t,e,r){return e=h(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,i()?Reflect.construct(e,r||[],h(t).constructor):e.apply(t,r))}function i(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(i=function(){return!!t})()}function r(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,r(a.key),a)}}function n(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function p(t,e){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},p(t,e)}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(arguments.length<3?t:i):a.value}},l.apply(this,arguments)}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,a,o,n,s=[],h=!0,p=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;h=!1}else for(;!(h=(r=o.call(i)).done)&&(s.push(r.value),s.length!==e);h=!0);}catch(t){p=!0,a=t}finally{try{if(!h&&null!=i.return&&(n=i.return(),Object(n)!==n))return}finally{if(p)throw a}}return s}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var c={name:"rok",parameters:{choices:{type:t.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},correct_choice:{type:t.ParameterType.KEYS,pretty_name:"Correct choice",default:void 0},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:0},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},number_of_oobs:{type:t.ParameterType.INT,pretty_name:"Number of oriented objectes",default:300},coherent_movement_direction:{type:t.ParameterType.INT,pretty_name:"Coherent movement direction",default:0},coherent_orientation:{type:t.ParameterType.INT,pretty_name:"Coherent object orientation",default:0},coherence_movement:{type:t.ParameterType.INT,pretty_name:"Movement coherence",default:50},coherence_orientation:{type:t.ParameterType.INT,pretty_name:"Orientation coherence",default:50},coherence_movement_opposite:{type:t.ParameterType.INT,pretty_name:"Opposite movement coherence",default:0},coherence_orientation_opposite:{type:t.ParameterType.INT,pretty_name:"Opposite orientation coherence",default:0},movement_speed:{type:t.ParameterType.INT,pretty_name:"Movement Speed",default:10},movement_speed_randomisation:{type:t.ParameterType.INT,pretty_name:"Movement speed randomisation",default:0},oob_size:{type:t.ParameterType.INT,pretty_name:"Object size",default:2},aperture_width:{type:t.ParameterType.INT,pretty_name:"Aperture width",default:600},aperture_height:{type:t.ParameterType.INT,pretty_name:"Aperture height",default:400},oob_color:{type:t.ParameterType.STRING,pretty_name:"Dot color",default:"white"},background_color:{type:t.ParameterType.STRING,pretty_name:"Background color",default:"gray"},border:{type:t.ParameterType.BOOL,pretty_name:"Border",default:!1},border_thickness:{type:t.ParameterType.INT,pretty_name:"Border width",default:1},border_color:{type:t.ParameterType.STRING,pretty_name:"Border Color",default:1},stimulus_type:{type:t.ParameterType.INT,pretty_name:"Stimulus type",default:0},aperture_shape:{type:t.ParameterType.INT,pretty_name:"aperture shape",default:0},aperture_background_color:{type:t.ParameterType.STRING,pretty_name:"Background of aperture",default:"#0000"},random_movement_type:{type:t.ParameterType.INT,pretty_name:"Random movement type",default:0},random_orientation_type:{type:t.ParameterType.INT,pretty_name:"Random orientation type",default:0},number_of_apertures:{type:t.ParameterType.INT,pretty_name:"Number of apertures",default:1},density_unit_area:{type:t.ParameterType.INT,pretty_name:"Density area",default:null},aperture_position_left:{type:t.ParameterType.INT,pretty_name:"Horizontal position of aperature",default:50},aperture_position_top:{type:t.ParameterType.INT,pretty_name:"Vertical position of aperature",default:50},prompt:{type:t.ParameterType.STRING,pretty_name:"Prompt",default:null},fade_out:{type:t.ParameterType.INT,pretty_name:"Fade out on edges",default:0},stimulus_image:{type:t.ParameterType.IMAGE,pretty_name:"Stimuli pictures",default:null},background_image:{type:t.ParameterType.IMAGE,pretty_name:"Background image",default:null},stimulus_image_keyframes:{type:t.ParameterType.INT,pretty_name:"Keyframes of stimulus pictures",default:1},background_image_keyframes:{type:t.ParameterType.INT,pretty_name:"Keframse of background pictures",default:1},stimulus_keyframe_time:{type:t.ParameterType.FLOAT,pretty_name:"Keyframe time",default:.1},stimulus_mirror:{type:t.ParameterType.INT,pretty_name:"Mirror image time",default:0},experiment_congruency_mode:{type:t.ParameterType.INT,pretty_name:"Experiment congruency mode",default:0},experiment_main_task:{type:t.ParameterType.INT,pretty_name:"Main task when experiment is set to congruency mode (0- movement, 1-orientation)",default:0},units:{type:t.ParameterType.STRING,pretty_name:"Units in which size and speed of oobs is expressed",default:null},aperture_draw_mode:{type:t.ParameterType.STRING,pretty_name:"When in overlay draws stimuli of different apertures on top of each other. When in intermixed oobs all show up in one aperture intermixed",default:"overlay"}}},y=function(){function t(e){a(this,t),this.jsPsych=e}return n(t,[{key:"trial",value:function(t,e){var i=this,r=ei(e.choices,[]),a=ei(e.correct_choice,void 0),o=ei(e.trial_duration,0),n=ei(e.response_ends_trial,!0),s=ei(e.number_of_oobs,300),h=ei(e.coherent_movement_direction,0),p=ei(e.coherent_orientation,0),l=ei(e.coherence_movement,50),u=ei(e.coherence_orientation,50),c=ei(e.coherence_movement_opposite,50),y=ei(e.coherence_orientation_opposite,50),_=ei(e.movement_speed,10),v=ei(e.movement_speed_randomisation,0),g=ei(e.oob_size,2),T=ei(e.aperture_width,600),O=ei(e.aperture_height,400),z=ei(e.oob_color,"white"),A=ei(e.background_color,"gray"),N=ei(e.aperture_background_color,"#0000");ei(e.border,!1),ei(e.border_thickness,1),ei(e.border_color,"white");var S=ei(e.stimulus_type,0),R=ei(e.aperture_shape,0),j=ei(e.random_movement_type,0),C=ei(e.random_orientation_type,0),E=ei(e.number_of_apertures,1),F=ei(e.density_unit_area,null),K=ei(e.aperture_position_left,50),W=ei(e.aperture_position_top,50),B=ei(e.prompt,null),L=ei(e.fade_out,0),H=ei(e.stimulus_image,null),D=ei(e.background_image,null),G=ei(e.stimulus_image_keyframes,1);ei(e.background_image_keyframes,1);var q=ei(e.stimulus_keyframe_time,.1),V=ei(e.stimulus_mirror,0),Y=ei(e.experiment_congruency_mode,0),U=ei(e.experiment_main_task,0),$=ei(e.units,null),J=ei(e.aperture_draw_mode,"overlay"),Q=E,X=Q;"overlay"!==J&&(Q=1);var Z=[],tt=[];if(Q>1)for(var et=0;et<Q;et++)tt.push(document.createElement("div")),Z.push(document.createElement("canvas"));else tt.push(document.createElement("div")),Z.push(document.createElement("canvas"));for(var it=0;it<Q;it++){if(null!=f(D,it)&&(tt[it].style.backgroundImage="url("+f(D,it)+")",tt[it].style.backgroundRepeat="no-repeat",tt[it].style.backgroundSize="cover"),t.appendChild(tt[it]),tt[it].appendChild(Z[it]),Array.isArray(B)){var rt=document.createElement("div");rt.style.margin="0",rt.style.padding="0",tt[it].appendChild(rt),rt.style.textAlign="center",rt.innerHTML=B[it],rt.style.position="absolute",rt.style.transform="translate(-50%, 100%)",rt.style.textAlign="center",rt.style.top=10+f(O,0)/2+"px",rt.style.width=f(T,0)+"px"}}if(null!=B&&!Array.isArray(B)){var at=document.createElement("div");at.style.margin="0",at.style.padding="0",tt[0].appendChild(at),at.style.textAlign="center",at.innerHTML=B,at.style.position="absolute",at.style.transform="translate(-50%, 100%)",at.style.textAlign="center",at.style.top=10+f(O,0)/2+"px",at.style.width=f(T,0)+"px"}var ot=document.getElementsByClassName("jspsych-display-element")[0],nt=ot.style.margin,st=ot.style.padding,ht=ot.style.backgroundColor;ot.style.margin="0",ot.style.padding="0";for(var pt=0;pt<Q;pt++)tt[pt].style.margin="0px",tt[pt].style.margin="0px",Z[pt].style.margin="0px",Z[pt].style.padding="0px",Z[pt].style.position="absolute",Z[pt].style.transform="translate(-50%, -50%)";ot.style.backgroundColor=A;for(var lt=[],mt=0;mt<Q;mt++)lt.push(Z[mt].getContext("2d"));for(var ut=ot.getBoundingClientRect(),ct=0;ct<Q;ct++)if(Z[ct].width=f(T,ct),Z[ct].height=f(O,ct),Z[ct].style.backgroundColor=f(N,ct),tt[ct].style.position="absolute",Array.isArray(K)&&Array.isArray(W)){var yt=Math.round(W[ct]*ut.height/100);tt[ct].style.top=yt.toString()+"px",tt[ct].style.left=K[ct].toString()+"%"}else if(Q>1){var ft=void 0;ft=Q%2==0?ct*(100/Q)+100/(2*Q):ct*(100/(Q+1))+100/(2*(Q-1));var dt=Math.round(W*ut.height/100);tt[ct].style.top=dt.toString()+"px",tt[ct].style.left=ft.toString()+"%"}else{var _t=Math.round(W*ut.height/100);tt[ct].style.top=_t.toString()+"px",tt[ct].style.left=K.toString()+"%"}var vt,gt,Tt=!1,xt=!1,bt={rt:-1,key:""},Pt=[],wt=0,kt=[];if(null!=H){var Mt=H;if(Array.isArray(Mt))for(var It=0;It<Mt.length;It++){var Ot=Mt[It];if(Array.isArray(Ot)){for(var zt=[],At=0;At<Ot[It].length;At++){var Nt=document.createElement("img");Nt.src=Ot[At],zt.push(Nt)}kt.push(zt)}else{var St=document.createElement("img");St.src=Ot,kt.push(St)}}else{var Rt=document.createElement("img");Rt.src=Mt,kt.push(Rt)}}for(var jt=[],Ct=0;Ct<X;Ct++){var Et=f(s,Ct);if(null!=F)Et=Et*(f(T,Ct)*f(O,Ct))/F;var Ft=f(l,Ct),Kt=f(c,Ct),Wt=f(u,Ct),Bt=f(y,Ct),Lt=f(Y,Ct),Ht=f(U,Ct),Dt=[],Gt=[];if(0===Lt){for(var qt=m(x(Ft,Kt,Et),3),Vt=qt[0],Yt=qt[1],Ut=qt[2],$t=m(x(Wt,Bt,Et),3),Jt=$t[0],Qt=$t[1],Xt=$t[2],Zt=0;Zt<Vt;Zt++)Gt.push(1);for(var te=0;te<Yt;te++)Gt.push(-1);for(var ee=0;ee<Ut;ee++)Gt.push(0);for(var ie=0;ie<Jt;ie++)Dt.push(1);for(var re=0;re<Qt;re++)Dt.push(-1);for(var ae=0;ae<Xt;ae++)Dt.push(0);Dt=b(Dt),Gt=b(Gt)}else if(0===Ht){var oe=m(x(Ft,Kt,Et),3),ne=oe[0],se=oe[1],he=oe[2],pe=Math.floor(Wt/100*ne),le=Math.floor(Bt/100*ne);Wt+Bt===100&&(le=ne-pe);for(var me=0;me<ne;me++)Gt.push(1);for(var ue=0;ue<se;ue++)Gt.push(-1);for(var ce=0;ce<he;ce++)Gt.push(0);for(var ye=0;ye<pe;ye++)Dt.push(1);for(var fe=0;fe<le;fe++)Dt.push(-1);for(var de=0;de<Et-(pe+le);de++)Dt.push(0)}else if(1===Ht){var _e=m(x(Wt,Bt,Et),3),ve=_e[0],ge=_e[1],Te=_e[2],xe=Math.floor(Ft/100*ve),be=Math.floor(Kt/100*ve);Ft+Kt===100&&(be=ve-xe);for(var Pe=0;Pe<ve;Pe++)Dt.push(1);for(var we=0;we<ge;we++)Dt.push(-1);for(var ke=0;ke<Te;ke++)Dt.push(0);for(var Me=0;Me<xe;Me++)Gt.push(1);for(var Ie=0;Ie<be;Ie++)Gt.push(-1);if(1===Lt)for(var Oe=0;Oe<Et-(xe+be);Oe++)Gt.push(0);else for(var ze=0;ze<Et-(xe+be);ze++)Dt.push(Dt[ze+xe+be])}var Ae=f(z,Ct),Ne=f(S,Ct);3===Ne&&(Ae=d(Ae));for(var Se=f(R,Ct),Re=f(_,Ct),je=f(v,Ct),Ce=f(g,Ct),Ee=f(L,Ct),Fe=0;Fe<Et;Fe++){var Ke=0,We=0,Be=f(p,Ct);-1===Dt[Fe]?Be+=180:0===Dt[Fe]&&(Be=Math.floor(360*Math.random()),We=f(C,Ct));var Le=f(h,Ct);-1===Gt[Fe]?Le+=180:0===Gt[Fe]&&(Le=Math.floor(360*Math.random()),Ke=f(j,Ct)),2===Lt&&0===Ht&&0===Dt[Fe]&&1!=Gt[Fe]?Be=Le:2===Lt&&1===Ht&&0===Gt[Fe]&&1!=Dt[Fe]&&(Le=Be);var He=void 0,De=lt[Ct],Ge=Z[Ct];if("overlay"!==J&&(De=lt[0],Ge=Z[0]),0===Ne)He=new P(Ce,Ae,Be,Le,Re,je,Se,Ke,We,Ee,Ge,De,$);else if(1===Ne)He=new k(Ce,Ae,Be,Le,Re,je,Se,Ke,We,Ee,Ge,De,$);else if(2===Ne)He=new M(Ce,Ae,Be,Le,Re,je,Se,Ke,We,Ee,Ge,De,$);else if(3===Ne)He=new w(Ce,Ae,Be,Le,Re,je,Se,Ke,We,Ee,Ge,De,$);else if(4===Ne){var qe=void 0,Ve=void 0,Ye=void 0,Ue=void 0;1===X?(qe=kt,Ve=G,Ye=q,Ue=V):(qe=f(kt,Ct),Ve=f(G,Ct),Ye=f(q,Ct),Ue=f(V,Ct)),He=new I(Ce,Ae,Be,Le,Re,je,Se,Ke,We,Ee,qe,Ve,Ye,Ue,Ge,De,$)}jt.push(He)}}jt=b(jt);var $e,Je,Qe,Xe=function(){Tt=!0,wt=Pt.length;var e=Pt;Pt=wt>0?Pt.reduce((function(t,e){return t+e}))/wt:0,void 0!==gt&&i.jsPsych.pluginAPI.cancelKeyboardResponse(gt);var m={rt:bt.rt,key_press:bt.key,correct:ti(),choices:r,correct_choice:a,trial_duration:o,response_ends_trial:n,number_of_oobs:s,coherent_movement_direction:h,coherence_movement:l,opposite_coherence_movement:c,coherent_orientation:p,coherence_orientation:u,opposite_coherence_orientation:y,movement_speed:_,oob_size:g,oob_color:z,movement_speed_randomisation:v,aperture_width:T,aperture_height:O,background_color:A,aperture_background_color:N,frame_rate:Pt,frame_rate_array:e,number_of_frames:wt,stimulus_type:S,aperture_shape:R,random_movemet_type:j,random_orientation_type:C,number_of_apertures:E,density_unit_area:F,prompt:B,aperture_position_left:K,aperture_position_top:W,aperture_mode:J};t.innerHTML="",ot.style.margin=nt,ot.style.padding=st,ot.style.backgroundColor=ht,i.jsPsych.finishTrial(m)};function Ze(t){""==bt.key&&(bt=t),n&&(window.clearTimeout(vt),Xe())}Je=0,Qe=window.requestAnimationFrame((function t(){if(Tt)window.cancelAnimationFrame(Qe);else if(Qe=window.requestAnimationFrame(t),!xt&&o>0&&(vt=window.setTimeout(Xe,o),xt=!0),function(t){for(var e=0;e<jt.length;e++)jt[e].update(t)}(Je),function(){for(var t=0;t<Z.length;t++)lt[t].clearRect(0,0,Z[t].width,Z[t].height);for(var e=0;e<jt.length;e++)jt[e].draw()}(),void 0===$e)$e=performance.now();else{var e=performance.now();document.hasFocus()?Je=e-$e:$e=performance.now(),Pt.push(Math.round(e-$e)),$e=e}})),"NO_KEYS"!=r&&(gt=i.jsPsych.pluginAPI.getKeyboardResponse({callback_function:Ze,valid_responses:r,rt_method:"performance",persist:!1,allow_held_key:!1}));var ti=function(){if(void 0!==a&&a.constructor===Array){if("string"==typeof a[0]||a[0]instanceof String){var t=a.every((function(t){return i.jsPsych.pluginAPI.compareKeys(t,bt.key)}));return t}return a[0],console.error("Error in ROK plugin: elements in the correct_choice array must be key characters (strings)."),!1}return console.error("Error in ROK plugin: you must specify an array of key characters for the correct_choice parameter."),!1};function ei(t,e){return void 0!==t?t:e}}}]),t}();
/**
   * **ROK**
   *
   * jsPsych plugin for showing a random object kinematogram stimulus and recording a keyboard response
   *
   * @author Younes Strittmatter
   * @see {@link https://www.jspsych.org/plugins/jspsych-rok/ RDK plugin documentation on jspsych.org}
   * @copyright
   *
   *    We would appreciate it if you cited this paper when you use the ROK:
   *
   * ----------------------
   *
   * Copyright (C) 2021 Younes Strittmatter
   *
   * This program is free software: you can redistribute it and/or modify
   * it under the terms of the GNU General Public License as published by
   * the Free Software Foundation, either version 3 of the License, or
   * (at your option) any later version.
   *
   * This program is distributed in the hope that it will be useful,
   * but WITHOUT ANY WARRANTY; without even the implied warranty of
   * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   * GNU General Public License for more details.
   *
   */function f(t,e){return Array.isArray(t)?t[e]:t}function d(t){var e=document.createElement("canvas");e.height=1,e.width=1;var i=e.getContext("2d");return i.fillStyle=t,i.fillRect(0,0,1,1),i.getImageData(0,0,1,1).data}function _(t,e){for(var i=[0,0,0,255],r=0;r<3;r++){var a=t[r]+e;a=(a=a>255?255:a)<0?0:a,i[r]=a}return i}function v(t){return"#"+[0,1,2].map((function(e){return("0"+t[e].toString(16)).slice(-2)})).join("")}function g(t){var e=t*Math.PI/180;return Math.cos(e)}function T(t){var e=t*Math.PI/180;return-Math.sin(e)}function x(t,e,i){var r,a=Math.round(t/100*i),o=i-a-(r=t+e==100?i-a:Math.round(e/100*i));return a+r>100&&50==t&&(a=100-r),[a,r,o]}function b(t){for(var e=t.length;0!==e;){var i=Math.floor(Math.random()*e),r=t[e-=1];t[e]=t[i],t[i]=r}return t}y.info=c;var P=function(){function t(e,i,r,o,n,s,h,p,l,m,u,c,y){if(a(this,t),this.canvas=u,this.size=u.width*e/100,"px"===y&&(this.size=e),this.color=i,this.ctx=c,this.pos={x:0,y:0},this.vel={x:0,y:0},0==h&&(this.pos.x=Math.random()*u.width,this.pos.y=Math.random()*u.height),1==h){var f=2*Math.random()*Math.PI,d=Math.sqrt(Math.sqrt(Math.random()))-.5;this.pos.x=d*Math.sin(f)*u.width+u.width/2,this.pos.y=d*Math.cos(f)*u.height+u.height/2}this.speedRes=u.width*n/100*(s/100*Math.random()-s/100+1),"px"===y&&(this.speedRes=n*(s/100*Math.random()-s/100+1)),this.orientation=r,this.movementDirection=o,this.setVel(),this.ld={x:0,y:0},this.lu={x:0,y:0},this.r={x:0,y:0},this.setOrient(),this.isRandomWalk=p,this.rW=10*(Math.random()-.5),this.isRandomOrientated=l,this.rO=10*(Math.random()-.5),this.apertureType=h,this.timeToChangeMovement=Math.random(),this.timeToChangeOrientation=Math.random(),this.isFade=m,this.alpha=1}return n(t,[{key:"setVel",value:function(){this.vel.x=g(this.movementDirection)*this.speedRes,this.vel.y=T(this.movementDirection)*this.speedRes}},{key:"setOrient",value:function(){this.ld.x=g(this.orientation+270)*this.size,this.ld.y=T(this.orientation+270)*this.size,this.lu.x=g(this.orientation+90)*this.size,this.lu.y=T(this.orientation+90)*this.size,this.r.x=g(this.orientation)*this.size,this.r.y=T(this.orientation)*this.size}},{key:"randomMovement",value:function(t){this.movementDirection+=this.rW*t/1e3,this.setVel(),this.timeToChangeMovement+=t/1e3;var e=1-this.timeToChangeMovement;e<0&&(this.rW=30*(Math.random()-.5),this.timeToChangeMovement=-e)}},{key:"randomOrientation",value:function(t){this.orientation+=this.rO*t/1e3,this.orientation<0?this.orientation=360-this.orientation:this.orientation>360&&(this.orientation=this.orientation-360),this.setOrient(),this.timeToChangeOrientation+=t/1e3;var e=1-this.timeToChangeOrientation;e<0&&(this.rO=60*(Math.random()-.5),this.setOrient(),this.timeToChangeOrientation=-e)}},{key:"handleOutOfBounds",value:function(){if(0==this.apertureType){this.alpha=.1,this.pos.x<-this.size?this.pos.x=this.canvas.width+this.size:this.pos.x>this.canvas.width+this.size&&(this.pos.x=-this.size),this.pos.y<-this.size?this.pos.y=this.canvas.height+this.size:this.pos.y>this.canvas.height+this.size&&(this.pos.y=-this.size);var t=Math.min(this.pos.x-this.size,this.pos.y-this.size,this.canvas.width-(this.pos.x+this.size),this.canvas.height-(this.pos.y+this.size));t<this.canvas.width/20&&this.isFade?(this.alpha=t/(this.canvas.width/20),this.alpha<0&&(this.alpha=0)):this.alpha=1}if(1==this.apertureType){this.alpha=.1;var e=this.canvas.width/2,i=this.canvas.height/2,r=this.pos.x-e,a=this.pos.y-i,o=r*r/(e*e)+a*a/(i*i);o>.7&&this.isFade?(this.alpha=(1-o)/.3,this.alpha<0&&(this.alpha=0)):this.alpha=1,o>1&&(r*=-.99,a*=-.99,this.pos.x=r+e,this.pos.y=a+i)}}},{key:"update",value:function(t){this.pos.x+=this.vel.x*t/1e3,this.pos.y+=this.vel.y*t/1e3,this.isRandomWalk&&this.randomMovement(t),this.isRandomOrientated&&this.randomOrientation(t),this.handleOutOfBounds()}},{key:"draw",value:function(){this.ctx.globalAlpha=this.alpha,this.ctx.beginPath();var t=this.pos.x+this.ld.x,e=this.pos.y+this.ld.y;this.ctx.moveTo(t,e),t=this.pos.x+this.lu.x,e=this.pos.y+this.lu.y,this.ctx.lineTo(t,e),t=this.pos.x+this.r.x,e=this.pos.y+this.r.y,this.ctx.lineTo(t,e),this.ctx.fillStyle=this.color,this.ctx.fill()}}]),t}(),w=function(t){function i(t,r,o,n,s,h,p,l,m,u,c,y,f){var d;a(this,i),(d=e(this,i,[t,r,o,n,s,h,p,l,m,u,c,y,f])).animationTime=Math.random(),d.animationFrame=4,d.animationTime<.8&&(d.animationFrame=3),d.animationTime<.6&&(d.animationFrame=2),d.animationTime<.4&&(d.animationFrame=1),d.animationTime<.2&&(d.animationFrame=0),d.animationTime*=.1,d.animdir=1;var _=r;return d.makeColors(_,o),d}return s(i,t),n(i,[{key:"makeColors",value:function(t,e){this.colorsLeft=[],this.colorsRight=[];var i=Math.round(5*-T(e)),r=Math.round(5*g(e)),a=_(t,i),o=_(t,r);this.colorsRight.push(v(a)),this.colorsLeft.push(v(o));for(var n=0;n<6;n++)a=_(a,i),o=_(o,r),this.colorsRight.push(v(a)),this.colorsLeft.push(v(o))}},{key:"update",value:function(t){l(h(i.prototype),"update",this).call(this,t),this.animationTime+=t/1e3;var e=.1-this.animationTime;e<0&&(this.animationFrame+=this.animdir,this.animationTime=-e,(this.animationFrame>5||this.animationFrame<1)&&(this.animationTime-=.1,this.animdir*=-1))}},{key:"draw",value:function(){this.ctx.globalAlpha=this.alpha;var t=this.pos.x+.2*this.r.x,e=this.pos.y+.2*this.r.y;this.ctx.beginPath(),this.ctx.moveTo(t,e);var i=this.pos.x+this.ld.x/(.1*this.animationFrame+1),r=this.pos.y+this.ld.y/(.1*this.animationFrame+1);this.ctx.lineTo(i,r),i=this.pos.x+this.r.x,r=this.pos.y+this.r.y,this.ctx.lineTo(i,r),this.ctx.fillStyle=this.colorsRight[this.animationFrame],this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(t,e),i=this.pos.x+this.lu.x/(.1*this.animationFrame+1),r=this.pos.y+this.lu.y/(.1*this.animationFrame+1),this.ctx.lineTo(i,r),i=this.pos.x+this.r.x,r=this.pos.y+this.r.y,this.ctx.lineTo(i,r),this.ctx.fillStyle=this.colorsLeft[this.animationFrame],this.ctx.fill()}}]),i}(P),k=function(t){function i(){return a(this,i),e(this,i,arguments)}return s(i,t),n(i,[{key:"draw",value:function(){this.ctx.globalAlpha=this.alpha,this.ctx.beginPath(),this.ctx.arc(this.pos.x,this.pos.y,this.size/2,0,2*Math.PI),this.ctx.fillStyle=this.color,this.ctx.fill()}}]),i}(P),M=function(t){function i(){return a(this,i),e(this,i,arguments)}return s(i,t),n(i,[{key:"draw",value:function(){this.ctx.globalAlpha=this.alpha,this.ctx.beginPath();var t=this.pos.x-this.size/2,e=this.pos.y-this.size/2;this.ctx.moveTo(t,e),t=this.pos.x+this.size/2,e=this.pos.y-this.size/2,this.ctx.lineTo(t,e),t=this.pos.x+this.size/2,e=this.pos.y+this.size/2,this.ctx.lineTo(t,e),t=this.pos.x-this.size/2,e=this.pos.y+this.size/2,this.ctx.lineTo(t,e),this.ctx.fillStyle=this.color,this.ctx.fill()}}]),i}(P),I=function(t){function i(t,r,o,n,s,h,p,l,m,u,c,y,d,_,v,g,T){var x;if(a(this,i),x=e(this,i,[t,r,o,n,s,h,p,l,m,u,v,g,T]),Array.isArray(c)){var b=Math.floor(Math.random()*c.length);x.img=c[b],x.keyframes=f(y,b),x.keyframeTime=f(d,b),x.mirrorType=f(_,b)}else x.img=c,x.keyframes=y,x.keyframeTime=d,x.mirrorType=_;return x.imgWidth=x.img.naturalWidth/x.keyframes,x.imgHeight=x.img.naturalHeight,x.actualKeyframe=Math.floor(Math.random()*x.keyframes),x.animationTime=Math.random()*x.keyframeTime,x}return s(i,t),n(i,[{key:"update",value:function(t){l(h(i.prototype),"update",this).call(this,t),this.animationTime+=t/1e3,this.keyframeTime-this.animationTime<0&&(this.animationTime=0,this.actualKeyframe++,this.actualKeyframe>=this.keyframes&&(this.actualKeyframe=0))}},{key:"draw",value:function(){this.ctx.globalAlpha=this.alpha,this.ctx.translate(this.pos.x,this.pos.y),0===this.mirrorType?this.ctx.rotate(-Math.PI*this.orientation/180):1==this.mirrorType&&(this.orientation>90&&this.orientation<270?this.ctx.rotate(-Math.PI*(this.orientation-180)/180):this.ctx.rotate(-Math.PI*this.orientation/180)),this.ctx.translate(-this.pos.x,-this.pos.y),0===this.mirrorType?this.ctx.drawImage(this.img,this.actualKeyframe*this.imgWidth,0,this.imgWidth,this.imgHeight,this.pos.x-this.size/2,this.pos.y-this.size/2,this.size,this.size):1===this.mirrorType&&(this.orientation>90&&this.orientation<270?this.ctx.drawImage(this.img,this.actualKeyframe*this.imgWidth,this.imgHeight/2,this.imgWidth,this.imgHeight/2,this.pos.x-this.size/2,this.pos.y-this.size/2,this.size,this.size):this.ctx.drawImage(this.img,this.actualKeyframe*this.imgWidth,0,this.imgWidth,this.imgHeight/2,this.pos.x-this.size/2,this.pos.y-this.size/2,this.size,this.size)),this.ctx.translate(this.pos.x,this.pos.y),0===this.mirrorType?this.ctx.rotate(Math.PI*this.orientation/180):1===this.mirrorType&&(this.orientation>90&&this.orientation<270?this.ctx.rotate(Math.PI*(this.orientation-180)/180):this.ctx.rotate(Math.PI*this.orientation/180)),this.ctx.translate(-this.pos.x,-this.pos.y)}}]),i}(P);return y}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
